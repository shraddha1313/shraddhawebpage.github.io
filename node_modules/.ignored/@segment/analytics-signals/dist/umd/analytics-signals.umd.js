!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AnalyticsBrowserSignals=e():t.AnalyticsBrowserSignals=e()}(self,(function(){return function(){var t,e,r={544:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(r(605));function i(t,e){return function(){var r=this.traits(),n=this.properties?this.properties():{};return o.default(r,"address."+t)||o.default(r,t)||(e?o.default(r,"address."+e):null)||(e?o.default(r,e):null)||o.default(n,"address."+t)||o.default(n,t)||(e?o.default(n,"address."+e):null)||(e?o.default(n,e):null)}}e.default=function(t){t.zip=i("postalCode","zip"),t.country=i("country"),t.street=i("street"),t.state=i("state"),t.city=i("city"),t.region=i("region")}},492:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Alias=void 0;var o=n(r(726)),i=r(416);function a(t,e){i.Facade.call(this,t,e)}e.Alias=a,o.default(a,i.Facade),a.prototype.action=function(){return"alias"},a.prototype.type=a.prototype.action,a.prototype.previousId=function(){return this.field("previousId")||this.field("from")},a.prototype.from=a.prototype.previousId,a.prototype.userId=function(){return this.field("userId")||this.field("to")},a.prototype.to=a.prototype.userId},365:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clone=void 0,e.clone=function t(e){if("[object Object]"===Object.prototype.toString.call(e)){var r={};for(var n in e)r[n]=t(e[n]);return r}return Array.isArray(e)?e.map(t):e}},741:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Delete=void 0;var o=n(r(726)),i=r(416);function a(t,e){i.Facade.call(this,t,e)}e.Delete=a,o.default(a,i.Facade),a.prototype.type=function(){return"delete"}},416:function(t,e,r){"use strict";function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Facade=void 0;var i=o(r(544)),a=r(365),u=o(r(530)),c=o(r(704)),s=o(r(605)),l=o(r(403));function f(t,e){e=e||{},this.raw=a.clone(t),"clone"in e||(e.clone=!0),e.clone&&(t=a.clone(t)),"traverse"in e||(e.traverse=!0),t.timestamp="timestamp"in t?c.default(t.timestamp):new Date,e.traverse&&l.default(t),this.opts=e,this.obj=t}e.Facade=f;var p=f.prototype;function h(t){return a.clone(t)}p.proxy=function(t){var e=t.split("."),r=this[t=e.shift()]||this.field(t);return r?("function"==typeof r&&(r=r.call(this)||{}),0===e.length||(r=s.default(r,e.join("."))),this.opts.clone?h(r):r):r},p.field=function(t){var e=this.obj[t];return this.opts.clone?h(e):e},f.proxy=function(t){return function(){return this.proxy(t)}},f.field=function(t){return function(){return this.field(t)}},f.multi=function(t){return function(){var e=this.proxy(t+"s");if(Array.isArray(e))return e;var r=this.proxy(t);return r&&(r=[this.opts.clone?a.clone(r):r]),r||[]}},f.one=function(t){return function(){var e=this.proxy(t);if(e)return e;var r=this.proxy(t+"s");return Array.isArray(r)?r[0]:void 0}},p.json=function(){var t=this.opts.clone?a.clone(this.obj):this.obj;return this.type&&(t.type=this.type()),t},p.rawEvent=function(){return this.raw},p.options=function(t){var e=this.obj.options||this.obj.context||{},r=this.opts.clone?a.clone(e):e;if(!t)return r;if(this.enabled(t)){var o=this.integrations(),i=o[t]||s.default(o,t);return"object"!==n(i)&&(i=s.default(this.options(),t)),"object"===n(i)?i:{}}},p.context=p.options,p.enabled=function(t){var e=this.proxy("options.providers.all");"boolean"!=typeof e&&(e=this.proxy("options.all")),"boolean"!=typeof e&&(e=this.proxy("integrations.all")),"boolean"!=typeof e&&(e=!0);var r=e&&u.default(t),n=this.integrations();if(n.providers&&n.providers.hasOwnProperty(t)&&(r=n.providers[t]),n.hasOwnProperty(t)){var o=n[t];r="boolean"!=typeof o||o}return!!r},p.integrations=function(){return this.obj.integrations||this.proxy("options.providers")||this.options()},p.active=function(){var t=this.proxy("options.active");return null==t&&(t=!0),t},p.anonymousId=function(){return this.field("anonymousId")||this.field("sessionId")},p.sessionId=p.anonymousId,p.groupId=f.proxy("options.groupId"),p.traits=function(t){var e=this.proxy("options.traits")||{},r=this.userId();for(var n in t=t||{},r&&(e.id=r),t){var o=null==this[n]?this.proxy("options.traits."+n):this[n]();null!=o&&(e[t[n]]=o,delete e[n])}return e},p.library=function(){var t=this.proxy("options.library");return t?"string"==typeof t?{name:t,version:null}:t:{name:"unknown",version:null}},p.device=function(){var t=this.proxy("context.device");"object"===n(t)&&null!==t||(t={});var e=this.library().name;return t.type||(e.indexOf("ios")>-1&&(t.type="ios"),e.indexOf("android")>-1&&(t.type="android")),t},p.userAgent=f.proxy("context.userAgent"),p.timezone=f.proxy("context.timezone"),p.timestamp=f.field("timestamp"),p.channel=f.field("channel"),p.ip=f.proxy("context.ip"),p.userId=f.field("userId"),i.default(p)},155:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Group=void 0;var o=n(r(726)),i=n(r(439)),a=n(r(704)),u=r(416);function c(t,e){u.Facade.call(this,t,e)}e.Group=c,o.default(c,u.Facade);var s=c.prototype;s.action=function(){return"group"},s.type=s.action,s.groupId=u.Facade.field("groupId"),s.created=function(){var t=this.proxy("traits.createdAt")||this.proxy("traits.created")||this.proxy("properties.createdAt")||this.proxy("properties.created");if(t)return a.default(t)},s.email=function(){var t=this.proxy("traits.email");if(t)return t;var e=this.groupId();return i.default(e)?e:void 0},s.traits=function(t){var e=this.properties(),r=this.groupId();for(var n in t=t||{},r&&(e.id=r),t){var o=null==this[n]?this.proxy("traits."+n):this[n]();null!=o&&(e[t[n]]=o,delete e[n])}return e},s.name=u.Facade.proxy("traits.name"),s.industry=u.Facade.proxy("traits.industry"),s.employees=u.Facade.proxy("traits.employees"),s.properties=function(){return this.field("traits")||this.field("properties")||{}}},398:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Identify=void 0;var o=r(416),i=n(r(605)),a=n(r(726)),u=n(r(439)),c=n(r(704)),s=function(t){return t.trim()};function l(t,e){o.Facade.call(this,t,e)}e.Identify=l,a.default(l,o.Facade);var f=l.prototype;f.action=function(){return"identify"},f.type=f.action,f.traits=function(t){var e=this.field("traits")||{},r=this.userId();for(var n in t=t||{},r&&(e.id=r),t){var o=null==this[n]?this.proxy("traits."+n):this[n]();null!=o&&(e[t[n]]=o,n!==t[n]&&delete e[n])}return e},f.email=function(){var t=this.proxy("traits.email");if(t)return t;var e=this.userId();return u.default(e)?e:void 0},f.created=function(){var t=this.proxy("traits.created")||this.proxy("traits.createdAt");if(t)return c.default(t)},f.companyCreated=function(){var t=this.proxy("traits.company.created")||this.proxy("traits.company.createdAt");if(t)return c.default(t)},f.companyName=function(){return this.proxy("traits.company.name")},f.name=function(){var t=this.proxy("traits.name");if("string"==typeof t)return s(t);var e=this.firstName(),r=this.lastName();return e&&r?s(e+" "+r):void 0},f.firstName=function(){var t=this.proxy("traits.firstName");if("string"==typeof t)return s(t);var e=this.proxy("traits.name");return"string"==typeof e?s(e).split(" ")[0]:void 0},f.lastName=function(){var t=this.proxy("traits.lastName");if("string"==typeof t)return s(t);var e=this.proxy("traits.name");if("string"==typeof e){var r=s(e).indexOf(" ");if(-1!==r)return s(e.substr(r+1))}},f.uid=function(){return this.userId()||this.username()||this.email()},f.description=function(){return this.proxy("traits.description")||this.proxy("traits.background")},f.age=function(){var t=this.birthday(),e=i.default(this.traits(),"age");return null!=e?e:t instanceof Date?(new Date).getFullYear()-t.getFullYear():void 0},f.avatar=function(){var t=this.traits();return i.default(t,"avatar")||i.default(t,"photoUrl")||i.default(t,"avatarUrl")},f.position=function(){var t=this.traits();return i.default(t,"position")||i.default(t,"jobTitle")},f.username=o.Facade.proxy("traits.username"),f.website=o.Facade.one("traits.website"),f.websites=o.Facade.multi("traits.website"),f.phone=o.Facade.one("traits.phone"),f.phones=o.Facade.multi("traits.phone"),f.address=o.Facade.proxy("traits.address"),f.gender=o.Facade.proxy("traits.gender"),f.birthday=o.Facade.proxy("traits.birthday")},640:function(t,e,r){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.Delete=e.Screen=e.Page=e.Track=e.Identify=e.Group=e.Alias=e.Facade=void 0;var o=r(416);Object.defineProperty(e,"Facade",{enumerable:!0,get:function(){return o.Facade}});var i=r(492);Object.defineProperty(e,"Alias",{enumerable:!0,get:function(){return i.Alias}});var a=r(155);Object.defineProperty(e,"Group",{enumerable:!0,get:function(){return a.Group}});var u=r(398);Object.defineProperty(e,"Identify",{enumerable:!0,get:function(){return u.Identify}});var c=r(235);Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return c.Track}});var s=r(241);Object.defineProperty(e,"Page",{enumerable:!0,get:function(){return s.Page}});var l=r(482);Object.defineProperty(e,"Screen",{enumerable:!0,get:function(){return l.Screen}});var f=r(741);Object.defineProperty(e,"Delete",{enumerable:!0,get:function(){return f.Delete}}),e.default=n(n({},o.Facade),{Alias:i.Alias,Group:a.Group,Identify:u.Identify,Track:c.Track,Page:s.Page,Screen:l.Screen,Delete:f.Delete})},439:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=/.+\@.+\..+/;e.default=function(t){return r.test(t)}},530:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={Salesforce:!0};e.default=function(t){return!r[t]}},241:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Page=void 0;var o=n(r(726)),i=r(416),a=r(235),u=n(r(439));function c(t,e){i.Facade.call(this,t,e)}e.Page=c,o.default(c,i.Facade);var s=c.prototype;s.action=function(){return"page"},s.type=s.action,s.category=i.Facade.field("category"),s.name=i.Facade.field("name"),s.title=i.Facade.proxy("properties.title"),s.path=i.Facade.proxy("properties.path"),s.url=i.Facade.proxy("properties.url"),s.referrer=function(){return this.proxy("context.referrer.url")||this.proxy("context.page.referrer")||this.proxy("properties.referrer")},s.properties=function(t){var e=this.field("properties")||{},r=this.category(),n=this.name();for(var o in t=t||{},r&&(e.category=r),n&&(e.name=n),t){var i=null==this[o]?this.proxy("properties."+o):this[o]();null!=i&&(e[t[o]]=i,o!==t[o]&&delete e[o])}return e},s.email=function(){var t=this.proxy("context.traits.email")||this.proxy("properties.email");if(t)return t;var e=this.userId();return u.default(e)?e:void 0},s.fullName=function(){var t=this.category(),e=this.name();return e&&t?t+" "+e:e},s.event=function(t){return t?"Viewed "+t+" Page":"Loaded a Page"},s.track=function(t){var e=this.json();return e.event=this.event(t),e.timestamp=this.timestamp(),e.properties=this.properties(),new a.Track(e,this.opts)}},482:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Screen=void 0;var o=n(r(726)),i=r(241),a=r(235);function u(t,e){i.Page.call(this,t,e)}e.Screen=u,o.default(u,i.Page),u.prototype.action=function(){return"screen"},u.prototype.type=u.prototype.action,u.prototype.event=function(t){return t?"Viewed "+t+" Screen":"Loaded a Screen"},u.prototype.track=function(t){var e=this.json();return e.event=this.event(t),e.timestamp=this.timestamp(),e.properties=this.properties(),new a.Track(e,this.opts)}},235:function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Track=void 0;var o=n(r(726)),i=r(416),a=r(398),u=n(r(439)),c=n(r(605));function s(t,e){i.Facade.call(this,t,e)}e.Track=s,o.default(s,i.Facade);var l=s.prototype;l.action=function(){return"track"},l.type=l.action,l.event=i.Facade.field("event"),l.value=i.Facade.proxy("properties.value"),l.category=i.Facade.proxy("properties.category"),l.id=i.Facade.proxy("properties.id"),l.productId=function(){return this.proxy("properties.product_id")||this.proxy("properties.productId")},l.promotionId=function(){return this.proxy("properties.promotion_id")||this.proxy("properties.promotionId")},l.cartId=function(){return this.proxy("properties.cart_id")||this.proxy("properties.cartId")},l.checkoutId=function(){return this.proxy("properties.checkout_id")||this.proxy("properties.checkoutId")},l.paymentId=function(){return this.proxy("properties.payment_id")||this.proxy("properties.paymentId")},l.couponId=function(){return this.proxy("properties.coupon_id")||this.proxy("properties.couponId")},l.wishlistId=function(){return this.proxy("properties.wishlist_id")||this.proxy("properties.wishlistId")},l.reviewId=function(){return this.proxy("properties.review_id")||this.proxy("properties.reviewId")},l.orderId=function(){return this.proxy("properties.id")||this.proxy("properties.order_id")||this.proxy("properties.orderId")},l.sku=i.Facade.proxy("properties.sku"),l.tax=i.Facade.proxy("properties.tax"),l.name=i.Facade.proxy("properties.name"),l.price=i.Facade.proxy("properties.price"),l.total=i.Facade.proxy("properties.total"),l.repeat=i.Facade.proxy("properties.repeat"),l.coupon=i.Facade.proxy("properties.coupon"),l.shipping=i.Facade.proxy("properties.shipping"),l.discount=i.Facade.proxy("properties.discount"),l.shippingMethod=function(){return this.proxy("properties.shipping_method")||this.proxy("properties.shippingMethod")},l.paymentMethod=function(){return this.proxy("properties.payment_method")||this.proxy("properties.paymentMethod")},l.description=i.Facade.proxy("properties.description"),l.plan=i.Facade.proxy("properties.plan"),l.subtotal=function(){var t=c.default(this.properties(),"subtotal"),e=this.total()||this.revenue();if(t)return t;if(!e)return 0;if(this.total()){var r=this.tax();r&&(e-=r),(r=this.shipping())&&(e-=r),(r=this.discount())&&(e+=r)}return e},l.products=function(){var t=this.properties(),e=c.default(t,"products");return Array.isArray(e)?e.filter((function(t){return null!==t})):[]},l.quantity=function(){return(this.obj.properties||{}).quantity||1},l.currency=function(){return(this.obj.properties||{}).currency||"USD"},l.referrer=function(){return this.proxy("context.referrer.url")||this.proxy("context.page.referrer")||this.proxy("properties.referrer")},l.query=i.Facade.proxy("options.query"),l.properties=function(t){var e=this.field("properties")||{};for(var r in t=t||{}){var n=null==this[r]?this.proxy("properties."+r):this[r]();null!=n&&(e[t[r]]=n,delete e[r])}return e},l.username=function(){return this.proxy("traits.username")||this.proxy("properties.username")||this.userId()||this.sessionId()},l.email=function(){var t=this.proxy("traits.email")||this.proxy("properties.email")||this.proxy("options.traits.email");if(t)return t;var e=this.userId();return u.default(e)?e:void 0},l.revenue=function(){var t=this.proxy("properties.revenue"),e=this.event();return!t&&e&&e.match(/^[ _]?completed[ _]?order[ _]?|^[ _]?order[ _]?completed[ _]?$/i)&&(t=this.proxy("properties.total")),function(t){if(!t)return;if("number"==typeof t)return t;if("string"!=typeof t)return;if(t=t.replace(/\$/g,""),t=parseFloat(t),!isNaN(t))return t}(t)},l.cents=function(){var t=this.revenue();return"number"!=typeof t?this.value()||0:100*t},l.identify=function(){var t=this.json();return t.traits=this.traits(),new a.Identify(t,this.opts)}},403:function(t,e,r){"use strict";function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}var o=r(118);function i(t,e){return void 0===e&&(e=!0),t&&"object"===n(t)?function(t,e){return Object.keys(t).forEach((function(r){t[r]=i(t[r],e)})),t}(t,e):Array.isArray(t)?function(t,e){return t.forEach((function(r,n){t[n]=i(r,e)})),t}(t,e):o.is(t,e)?o.parse(t):t}t.exports=i},118:function(t,e){"use strict";var r=/^(\d{4})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:([ T])(\d{2}):?(\d{2})(?::?(\d{2})(?:[,\.](\d{1,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?)?)?$/;e.parse=function(t){var e=[1,5,6,7,11,12],n=r.exec(t),o=0;if(!n)return new Date(t);for(var i,a=0;i=e[a];a++)n[i]=parseInt(n[i],10)||0;n[2]=parseInt(n[2],10)||1,n[3]=parseInt(n[3],10)||1,n[2]--,n[8]=n[8]?(n[8]+"00").substring(0,3):0," "===n[4]?o=(new Date).getTimezoneOffset():"Z"!==n[9]&&n[10]&&(o=60*n[11]+n[12],"+"===n[10]&&(o=0-o));var u=Date.UTC(n[1],n[2],n[3],n[5],n[6]+o,n[7],n[8]);return new Date(u)},e.is=function(t,e){return"string"==typeof t&&((!e||!1!==/^\d{4}-\d{2}-\d{2}/.test(t))&&r.test(t))}},726:function(t){"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}}},704:function(t,e,r){"use strict";var n=r(118),o=r(811),i=r(133),a=Object.prototype.toString;t.exports=function(t){return e=t,"[object Date]"===a.call(e)?t:function(t){return"[object Number]"===a.call(t)}(t)?new Date((r=t)<315576e5?1e3*r:r):n.is(t)?n.parse(t):o.is(t)?o.parse(t):i.is(t)?i.parse(t):new Date(t);var e,r}},811:function(t,e){"use strict";var r=/\d{13}/;e.is=function(t){return r.test(t)},e.parse=function(t){return t=parseInt(t,10),new Date(t)}},133:function(t,e){"use strict";var r=/\d{10}/;e.is=function(t){return r.test(t)},e.parse=function(t){var e=1e3*parseInt(t,10);return new Date(e)}},605:function(t){function e(t){return function(e,r,n,i){var a,u=i&&function(t){return"function"==typeof t}(i.normalizer)?i.normalizer:o;r=u(r);for(var c=!1;!c;)s();function s(){for(a in e){var t=u(a);if(0===r.indexOf(t)){var n=r.substr(t.length);if("."===n.charAt(0)||0===n.length){r=n.substr(1);var o=e[a];return null==o?void(c=!0):r.length?void(e=o):void(c=!0)}}}a=void 0,c=!0}if(a)return null==e?e:t(e,a,n)}}function r(t,e){return t.hasOwnProperty(e)&&delete t[e],t}function n(t,e,r){return t.hasOwnProperty(e)&&(t[e]=r),t}function o(t){return t.replace(/[^a-zA-Z0-9\.]+/g,"").toLowerCase()}t.exports=e((function(t,e){if(t.hasOwnProperty(e))return t[e]})),t.exports.find=t.exports,t.exports.replace=function(t,r,o,i){return e(n).call(this,t,r,o,i),t},t.exports.del=function(t,n,o){return e(r).call(this,t,n,null,o),t}},51:function(t,e,r){"use strict";r.d(e,{C6:function(){return o},Cl:function(){return i},Tt:function(){return a},YH:function(){return c},fX:function(){return s},sH:function(){return u}});var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var i=function(){return i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},i.apply(this,arguments)};function a(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}function u(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function u(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}c((n=n.apply(t,e||[])).next())}))}function c(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,n=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=e.call(t,a)}catch(t){u=[6,t],n=0}finally{r=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}Object.create;function s(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}Object.create},531:function(t,e,r){"use strict";r.d(e,{W:function(){return o}});var n=r(640);function o(t,e){var r=new n.Facade(t,e);return"track"===t.type&&(r=new n.Track(t,e)),"identify"===t.type&&(r=new n.Identify(t,e)),"page"===t.type&&(r=new n.Page(t,e)),"alias"===t.type&&(r=new n.Alias(t,e)),"group"===t.type&&(r=new n.Group(t,e)),"screen"===t.type&&(r=new n.Screen(t,e)),Object.defineProperty(r,"obj",{value:t,writable:!0}),r}},467:function(t,e,r){"use strict";function n(t,e){return new Promise((function(r,n){var o=setTimeout((function(){n(Error("Promise timed out"))}),e);t.then((function(t){return clearTimeout(o),r(t)})).catch(n)}))}function o(t,e,r){var o;return(o=r,new Promise((function(t){return setTimeout(t,o)}))).then((function(){return n(function(){try{return Promise.resolve(e(t))}catch(t){return Promise.reject(t)}}(),1e3)})).catch((function(e){null==t||t.log("warn","Callback Error",{error:e}),null==t||t.stats.increment("callback_error")})).then((function(){return t}))}r.d(e,{s2:function(){return n},w_:function(){return o}})},760:function(t,e,r){"use strict";r.d(e,{d:function(){return c},j:function(){return s}});var n=r(868),o=r(192),i=r(51),a=function(){function t(){this._logs=[]}return t.prototype.log=function(t,e,r){var n=new Date;this._logs.push({level:t,message:e,time:n,extras:r})},Object.defineProperty(t.prototype,"logs",{get:function(){return this._logs},enumerable:!1,configurable:!0}),t.prototype.flush=function(){if(this.logs.length>1){var t=this._logs.reduce((function(t,e){var r,n,o,a=(0,i.Cl)((0,i.Cl)({},e),{json:JSON.stringify(e.extras,null," "),extras:e.extras});delete a.time;var u=null!==(o=null===(n=e.time)||void 0===n?void 0:n.toISOString())&&void 0!==o?o:"";return t[u]&&(u="".concat(u,"-").concat(Math.random())),(0,i.Cl)((0,i.Cl)({},t),((r={})[u]=a,r))}),{});console.table?console.table(t):console.log(t)}else this.logs.forEach((function(t){var e=t.level,r=t.message,n=t.extras;"info"===e||"debug"===e?console.log(r,null!=n?n:""):console[e](r,null!=n?n:"")}));this._logs=[]},t}(),u=r(19),c=function(t){var e,r,n;this.retry=null===(e=t.retry)||void 0===e||e,this.type=null!==(r=t.type)&&void 0!==r?r:"plugin Error",this.reason=null!==(n=t.reason)&&void 0!==n?n:""},s=function(){function t(t,e,r,o){void 0===e&&(e=(0,n.v4)()),void 0===r&&(r=new u.r),void 0===o&&(o=new a),this.attempts=0,this.event=t,this._id=e,this.logger=o,this.stats=r}return t.system=function(){},t.prototype.isSame=function(t){return t.id===this.id},t.prototype.cancel=function(t){if(t)throw t;throw new c({reason:"Context Cancel"})},t.prototype.log=function(t,e,r){this.logger.log(t,e,r)},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.prototype.updateEvent=function(t,e){var r;if("integrations"===t.split(".")[0]){var n=t.split(".")[1];if(!1===(null===(r=this.event.integrations)||void 0===r?void 0:r[n]))return this.event}return(0,o.J)(this.event,t,e),this.event},t.prototype.failedDelivery=function(){return this._failedDelivery},t.prototype.setFailedDelivery=function(t){this._failedDelivery=t},t.prototype.logs=function(){return this.logger.logs},t.prototype.flush=function(){this.logger.flush(),this.stats.flush()},t.prototype.toJSON=function(){return{id:this._id,event:this.event,logs:this.logger.logs,metrics:this.stats.metrics}},t}()},19:function(t,e,r){"use strict";r.d(e,{p:function(){return o},r:function(){return i}});var n=r(51),o=function(){function t(){this.metrics=[]}return t.prototype.increment=function(t,e,r){void 0===e&&(e=1),this.metrics.push({metric:t,value:e,tags:null!=r?r:[],type:"counter",timestamp:Date.now()})},t.prototype.gauge=function(t,e,r){this.metrics.push({metric:t,value:e,tags:null!=r?r:[],type:"gauge",timestamp:Date.now()})},t.prototype.flush=function(){var t=this.metrics.map((function(t){return(0,n.Cl)((0,n.Cl)({},t),{tags:t.tags.join(",")})}));console.table?console.table(t):console.log(t),this.metrics=[]},t.prototype.serialize=function(){return this.metrics.map((function(t){return{m:t.metric,v:t.value,t:t.tags,k:(e=t.type,{gauge:"g",counter:"c"}[e]),e:t.timestamp};var e}))},t}(),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,n.C6)(e,t),e.prototype.gauge=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.increment=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.flush=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.serialize=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return[]},e}(o)},322:function(t,e,r){"use strict";function n(t){return"string"==typeof t}function o(t){return"number"==typeof t}function i(t){return"function"==typeof t}function a(t){return null!=t}function u(t){return"object"===Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}r.d(e,{Et:function(){return o},Kg:function(){return n},Qd:function(){return u},Tn:function(){return i},t2:function(){return a}})},868:function(t,e,r){"use strict";r.d(e,{v4:function(){return a}});for(var n,o=256,i=[];o--;)i[o]=(o+256).toString(16).substring(1);function a(){var t,e=0,r="";if(!n||o+16>256){for(n=Array(e=256);e--;)n[e]=256*Math.random()|0;e=o=0}for(;e<16;e++)t=n[o+e],r+=6==e?i[15&t|64]:8==e?i[63&t|128]:i[t],1&e&&e>1&&e<11&&(r+="-");return o++,r}},192:function(t,e,r){"use strict";function n(t,e,r){e.split&&(e=e.split("."));for(var n,o,i=0,a=e.length,u=t;i<a&&"__proto__"!=(o=""+e[i++])&&"constructor"!==o&&"prototype"!==o;)u=u[o]=i===a?r:typeof(n=u[o])==typeof e?n:0*e[i]!=0||~(""+e[i]).indexOf(".")?{}:[]}r.d(e,{J:function(){return n}})}},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={exports:{}};return r[t].call(i.exports,i,i.exports,o),i.exports}o.m=r,o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,{a:e}),e},o.d=function(t,e){for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.f={},o.e=function(t){return Promise.all(Object.keys(o.f).reduce((function(e,r){return o.f[r](t,e),e}),[]))},o.u=function(t){return{248:"auto-track",538:"queryString",751:"middleware"}[t]+"."+{248:"93528234cf272132baf8",538:"692562fc5270b9533b56",751:"1f833c9f1bd04e6c1b74"}[t]+".js"},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},t={},e="@segment/analytics-signals:",o.l=function(r,n,i,a){if(t[r])t[r].push(n);else{var u,c;if(void 0!==i)for(var s=document.getElementsByTagName("script"),l=0;l<s.length;l++){var f=s[l];if(f.getAttribute("src")==r||f.getAttribute("data-webpack")==e+i){u=f;break}}u||(c=!0,(u=document.createElement("script")).charset="utf-8",u.timeout=120,o.nc&&u.setAttribute("nonce",o.nc),u.setAttribute("data-webpack",e+i),u.src=r),t[r]=[n];var p=function(e,n){u.onerror=u.onload=null,clearTimeout(h);var o=t[r];if(delete t[r],u.parentNode&&u.parentNode.removeChild(u),o&&o.forEach((function(t){return t(n)})),e)return e(n)},h=setTimeout(p.bind(null,void 0,{type:"timeout",target:u}),12e4);u.onerror=p.bind(null,u.onerror),u.onload=p.bind(null,u.onload),c&&document.head.appendChild(u)}},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},function(){var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t}(),function(){var t={309:0};o.f.j=function(e,r){var n=o.o(t,e)?t[e]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise((function(r,o){n=t[e]=[r,o]}));r.push(n[2]=i);var a=o.p+o.u(e),u=new Error;o.l(a,(function(r){if(o.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;u.message="Loading chunk "+e+" failed.\n("+i+": "+a+")",u.name="ChunkLoadError",u.type=i,u.request=a,n[1](u)}}),"chunk-"+e,e)}};var e=function(e,r){var n,i,a=r[0],u=r[1],c=r[2],s=0;if(a.some((function(e){return 0!==t[e]}))){for(n in u)o.o(u,n)&&(o.m[n]=u[n]);if(c)c(o)}for(e&&e(r);s<a.length;s++)i=a[s],o.o(t,i)&&t[i]&&t[i][0](),t[i]=0},r=self.webpackChunk_segment_analytics_signals=self.webpackChunk_segment_analytics_signals||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var i={};return function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?e(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(e,r,n){return(r=function(e){var r=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,r||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===t(r)?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(){a=function(){return r};var e,r={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",s=u.asyncIterator||"@@asyncIterator",l=u.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(e){f=function(t,e,r){return t[e]=r}}function p(t,e,r,n){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),u=new T(n||[]);return i(a,"_invoke",{value:L(t,r,u)}),a}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=p;var y="suspendedStart",d="executing",v="completed",g={};function m(){}function b(){}function w(){}var S={};f(S,c,(function(){return this}));var x=Object.getPrototypeOf,O=x&&x(x(C([])));O&&O!==n&&o.call(O,c)&&(S=O);var j=w.prototype=m.prototype=Object.create(S);function E(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function k(e,r){function n(i,a,u,c){var s=h(e[i],e,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==t(f)&&o.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,u,c)}),(function(t){n("throw",t,u,c)})):r.resolve(f).then((function(t){l.value=t,u(l)}),(function(t){return n("throw",t,u,c)}))}c(s.arg)}var a;i(this,"_invoke",{value:function(t,e){function o(){return new r((function(r,o){n(t,e,r,o)}))}return a=a?a.then(o,o):o()}})}function L(t,r,n){var o=y;return function(i,a){if(o===d)throw new Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=_(u,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=h(t,r,n);if("normal"===s.type){if(o=n.done?v:"suspendedYield",s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=v,n.method="throw",n.arg=s.arg)}}}function _(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,_(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=h(o,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function C(r){if(r||""===r){var n=r[c];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var i=-1,a=function t(){for(;++i<r.length;)if(o.call(r,i))return t.value=r[i],t.done=!1,t;return t.value=e,t.done=!0,t};return a.next=a}}throw new TypeError(t(r)+" is not iterable")}return b.prototype=w,i(j,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,f(t,l,"GeneratorFunction")),t.prototype=Object.create(j),t},r.awrap=function(t){return{__await:t}},E(k.prototype),f(k.prototype,s,(function(){return this})),r.AsyncIterator=k,r.async=function(t,e,n,o,i){void 0===i&&(i=Promise);var a=new k(p(t,e,n,o),i);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(j),f(j,l,"Generator"),f(j,c,(function(){return this})),f(j,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return u.type="throw",u.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),s=o.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},r}function u(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function c(t){return new f(t,0)}function s(t){return function(){return new l(t.apply(this,arguments))}}function l(t){var e,r;function n(e,r){try{var i=t[e](r),a=i.value,u=a instanceof f;Promise.resolve(u?a.v:a).then((function(r){if(u){var c="return"===e?"return":"next";if(!a.k||r.done)return n(c,r);r=t[c](r).value}o(i.done?"return":"normal",r)}),(function(t){n("throw",t)}))}catch(t){o("throw",t)}}function o(t,o){switch(t){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?n(e.key,e.arg):r=null}this._invoke=function(t,o){return new Promise((function(i,a){var u={key:t,arg:o,resolve:i,reject:a,next:null};r?r=r.next=u:(e=r=u,n(t,o))}))},"function"!=typeof t.return&&(this.return=void 0)}function f(t,e){this.v=t,this.k=e}o.r(i),o.d(i,{SignalsPlugin:function(){return Xa}}),l.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},l.prototype.next=function(t){return this._invoke("next",t)},l.prototype.throw=function(t){return this._invoke("throw",t)},l.prototype.return=function(t){return this._invoke("return",t)};var p,h,y=function(t,e){return e.some((function(e){return t instanceof e}))};var d=new WeakMap,v=new WeakMap,g=new WeakMap;var m={get:function(t,e,r){if(t instanceof IDBTransaction){if("done"===e)return d.get(t);if("store"===e)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return x(t[e])},set:function(t,e,r){return t[e]=r,!0},has:function(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function b(t){m=t(m)}function w(t){return(h||(h=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.apply(O(this),r),x(this.request)}:function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return x(t.apply(O(this),r))}}function S(t){return"function"==typeof t?w(t):(t instanceof IDBTransaction&&function(t){if(!d.has(t)){var e=new Promise((function(e,r){var n=function(){t.removeEventListener("complete",o),t.removeEventListener("error",i),t.removeEventListener("abort",i)},o=function(){e(),n()},i=function(){r(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",o),t.addEventListener("error",i),t.addEventListener("abort",i)}));d.set(t,e)}}(t),y(t,p||(p=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,m):t)}function x(t){if(t instanceof IDBRequest)return e=t,r=new Promise((function(t,r){var n=function(){e.removeEventListener("success",o),e.removeEventListener("error",i)},o=function(){t(x(e.result)),n()},i=function(){r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",i)})),g.set(r,e),r;var e,r;if(v.has(t))return v.get(t);var n=S(t);return n!==t&&(v.set(t,n),g.set(n,t)),n}var O=function(t){return g.get(t)};function j(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.blocked,o=r.upgrade,i=r.blocking,a=r.terminated,u=indexedDB.open(t,e),c=x(u);return o&&u.addEventListener("upgradeneeded",(function(t){o(x(u.result),t.oldVersion,t.newVersion,x(u.transaction),t)})),n&&u.addEventListener("blocked",(function(t){return n(t.oldVersion,t.newVersion,t)})),c.then((function(t){a&&t.addEventListener("close",(function(){return a()})),i&&t.addEventListener("versionchange",(function(t){return i(t.oldVersion,t.newVersion,t)}))})).catch((function(){})),c}var E=["get","getKey","getAll","getAllKeys","count"],k=["put","add","delete","clear"],L=new Map;function _(t,e){if(t instanceof IDBDatabase&&!(e in t)&&"string"==typeof e){if(L.get(e))return L.get(e);var r=e.replace(/FromIndex$/,""),n=e!==r,o=k.includes(r);if(r in(n?IDBIndex:IDBObjectStore).prototype&&(o||E.includes(r))){var i=function(){var t,e=(t=a().mark((function t(e){var i,u,c,s,l,f,p=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(u=this.transaction(e,o?"readwrite":"readonly"),c=u.store,s=p.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=p[f];return n&&(c=c.index(l.shift())),t.next=6,Promise.all([(i=c)[r].apply(i,l),o&&u.done]);case 6:return t.abrupt("return",t.sent[0]);case 7:case"end":return t.stop()}}),t,this)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){u(i,n,o,a,c,"next",t)}function c(t){u(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return e.apply(this,arguments)}}();return L.set(e,i),i}}}b((function(t){return r(r({},t),{},{get:function(e,r,n){return _(e,r)||t.get(e,r,n)},has:function(e,r){return!!_(e,r)||t.has(e,r)}})}));var P=["continue","continuePrimaryKey","advance"],I={},T=new WeakMap,C=new WeakMap,A={get:function(t,e){if(!P.includes(e))return t[e];var r=I[e];return r||(r=I[e]=function(){var t;T.set(this,(t=C.get(this))[e].apply(t,arguments))}),r}};function N(){return F.apply(this,arguments)}function F(){return F=s(a().mark((function t(){var e,r,n,o=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=this)instanceof IDBCursor){t.next=5;break}return t.next=4,c((r=e).openCursor.apply(r,o));case 4:e=t.sent;case 5:if(e){t.next=7;break}return t.abrupt("return");case 7:n=new Proxy(e,A),C.set(n,e),g.set(n,O(e));case 11:if(!e){t.next=20;break}return t.next=14,n;case 14:return t.next=16,c(T.get(n)||e.continue());case 16:e=t.sent,T.delete(n),t.next=11;break;case 20:case"end":return t.stop()}}),t,this)}))),F.apply(this,arguments)}function G(t,e){return e===Symbol.asyncIterator&&y(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&y(t,[IDBIndex,IDBObjectStore])}b((function(t){return r(r({},t),{},{get:function(e,r,n){return G(e,r)?N:t.get(e,r,n)},has:function(e,r){return G(e,r)||t.has(e,r)}})}));var M=function(){var t=new URLSearchParams(window.location.search),e=t.get("segment_signals_debug")||t.get("seg_signals_debug");if("true"===e||"false"===e)return"true"===e};function D(t){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function H(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Y(n.key),n)}}function R(t,e,r){return e&&H(t.prototype,e),r&&H(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function B(t,e,r){return(e=Y(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Y(t){var e=function(t,e){if("object"!==D(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==D(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===D(e)?e:String(e)}var K=R((function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),B(this,"storage",void 0),B(this,"setItem",(function(t,e){try{var n=JSON.stringify(e);r.storage.setItem(t,n)}catch(r){console.warn("Storage set error",{key:t,value:e},r)}})),B(this,"getItem",(function(t){try{var e=r.storage.getItem(t);if(null===e)return;return JSON.parse(e)}catch(e){console.warn("Storage retrieval error",{key:t},e)}})),this.storage=e}));function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}function Z(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return X(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function W(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,V(n.key),n)}}function q(t,e,r){return(e=V(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function V(t){var e=function(t,e){if("object"!==z(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===z(e)?e:String(e)}var U=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),q(this,"logLevelKey","segment_signals_log_level"),q(this,"storage",new K(window.sessionStorage)),q(this,"enableLogging",(function(t){e.storage.setItem(e.logLevelKey,t)})),q(this,"disableLogging",(function(){e.storage.setItem(e.logLevelKey,"off")})),q(this,"log",(function(t){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(e=console).log.apply(e,["[signals:".concat(t,"]")].concat(n))})),q(this,"info",(function(){if("info"===e.logLevel||"debug"===e.logLevel){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.log.apply(e,["info"].concat(r))}})),q(this,"debug",(function(){if("debug"===e.logLevel){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.log.apply(e,["debug"].concat(r))}})),q(this,"logSignal",(function(t){e.info.apply(e,["New signal:",t.type,t.data].concat(Z("interaction"===t.type&&"change"in t.data?["change:",JSON.stringify(t.data.change,null,2)]:[])))}));var r=function(){var t=new URLSearchParams(window.location.search),e=t.get("segment_signals_log_level")||t.get("seg_signals_log_level");if("info"===e||"debug"===e||"off"===e)return e;"string"==typeof e&&console.error('Invalid signals_log_level: "'.concat(e,'". Valid options are: info, debug, off'))}();void 0!==r?"off"===r?this.disableLogging():this.enableLogging(r):!0===M()&&this.enableLogging("info")}var e,r,n;return e=t,(r=[{key:"logLevel",get:function(){var t;return null!==(t=this.storage.getItem(this.logLevelKey))&&void 0!==t?t:"off"}}])&&W(e.prototype,r),n&&W(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),J=new U;function Q(t){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q(t)}function $(){$=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Q(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Q(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function tt(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function et(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){tt(i,n,o,a,u,"next",t)}function u(t){tt(i,n,o,a,u,"throw",t)}a(void 0)}))}}function rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,at(n.key),n)}}function ot(t,e,r){return e&&nt(t.prototype,e),r&&nt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function it(t,e,r){return(e=at(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function at(t){var e=function(t,e){if("object"!==Q(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Q(e)?e:String(e)}var ut=function(){function t(e){var r;rt(this,t),it(this,"db",void 0),it(this,"maxBufferSize",void 0),it(this,"sessionKeyStorage",new K(window.sessionStorage)),this.maxBufferSize=null!==(r=e.maxBufferSize)&&void 0!==r?r:50,this.db=this.initSignalDB()}var e,r,n,o,i,a,u;return ot(t,[{key:"getStore",value:(u=et($().mark((function e(r,n){var o,i;return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=4;break}e.t0=n,e.next=7;break;case 4:return e.next=6,this.db;case 6:e.t0=e.sent;case 7:return o=e.t0,i=o.transaction(t.STORE_NAME,r).objectStore(t.STORE_NAME),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"initSignalDB",value:(a=et($().mark((function e(){var r,n;return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(t.DB_NAME,1,{upgrade:function(e){e.createObjectStore(t.STORE_NAME,{autoIncrement:!0})}});case 2:return r=e.sent,J.debug("Signals Buffer (indexDB) initialized"),e.next=6,this.getStore("readwrite",r);case 6:return n=e.sent,e.next=9,this.clearStoreIfNeeded(n);case 9:return e.next=11,this.countAndDeleteOldestIfNeeded(n,!0);case 11:return e.next=13,n.transaction.done;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"clearStoreIfNeeded",value:(i=et($().mark((function t(e){var r;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="segment_signals_db_session_key",sessionStorage.getItem(r)){t.next=6;break}return this.sessionKeyStorage.setItem(r,!0),t.next=5,e.clear();case 5:J.debug("New Session, so signals buffer cleared");case 6:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"add",value:(o=et($().mark((function t(e){var r;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStore("readwrite");case 2:return r=t.sent,t.next=5,r.add(e);case 5:return t.next=7,this.countAndDeleteOldestIfNeeded(r);case 7:return t.abrupt("return",r.transaction.done);case 8:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"countAndDeleteOldestIfNeeded",value:(n=et($().mark((function t(e){var r,n,o,i=arguments;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>1&&void 0!==i[1]&&i[1],t.next=3,e.count();case 3:if(!((n=t.sent)>this.maxBufferSize)){t.next=24;break}return t.next=7,e.openCursor();case 7:if(!(o=t.sent)){t.next=24;break}if(!r){t.next=21;break}case 10:if(!(n>this.maxBufferSize)){t.next=18;break}return t.next=13,o.delete();case 13:return t.next=15,o.continue();case 15:n--,t.next=10;break;case 18:J.debug("Signals Buffer: Purged signals to max buffer size of ".concat(this.maxBufferSize)),t.next=24;break;case 21:return t.next=23,o.delete();case 23:n--;case 24:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"getAll",value:(r=et($().mark((function t(){var e,r;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStore("readonly");case 2:return e=t.sent,t.next=5,e.getAll();case 5:return r=t.sent,t.next=8,e.transaction.done;case 8:return t.abrupt("return",r.reverse());case 9:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"clear",value:(e=et($().mark((function t(){var e;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getStore("readwrite");case 2:return e=t.sent,t.next=5,e.clear();case 5:return t.next=7,e.transaction.done;case 7:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}],[{key:"deleteDatabase",value:function(){return indexedDB.deleteDatabase(t.DB_NAME)}}]),t}();it(ut,"DB_NAME","Segment Signals Buffer"),it(ut,"STORE_NAME","signals");var ct=function(){function t(e){var r;rt(this,t),it(this,"storageKey","segment_signals_buffer"),it(this,"maxBufferSize",void 0),this.maxBufferSize=null!==(r=e.maxBufferSize)&&void 0!==r?r:50}return ot(t,[{key:"add",value:function(t){var e=this.getAll();e.unshift(t),e.length>this.maxBufferSize&&e.splice(-1),sessionStorage.setItem(this.storageKey,JSON.stringify(e))}},{key:"clear",value:function(){sessionStorage.removeItem(this.storageKey)}},{key:"getAll",value:function(){var t=sessionStorage.getItem(this.storageKey);return t?JSON.parse(t):[]}}]),t}(),st=function(){function t(e){rt(this,t),it(this,"store",void 0),this.store=e}var e,r,n;return ot(t,[{key:"add",value:(n=et($().mark((function t(e){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.store.add(e);case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",void 0);case 10:case"end":return t.stop()}}),t,this,[[0,6]])}))),function(t){return n.apply(this,arguments)})},{key:"getAll",value:(r=et($().mark((function t(){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.store.getAll();case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",[]);case 10:case"end":return t.stop()}}),t,this,[[0,6]])}))),function(){return r.apply(this,arguments)})},{key:"clear",value:(e=et($().mark((function t(){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.store.clear();case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",void 0);case 10:case"end":return t.stop()}}),t,this,[[0,6]])}))),function(){return e.apply(this,arguments)})}]),t}(),lt=function(t){var e,r=(null!==(e=t.signalStorage)&&void 0!==e?e:"session"===t.storageType)?new ct(t):new ut(t);return new st(r)};function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function pt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ht(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?pt(Object(r),!0).forEach((function(e){Ot(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function yt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=mt(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function dt(){dt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==ft(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ft(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function vt(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function gt(t){return function(t){if(Array.isArray(t))return bt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||mt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(t,e){if(t){if("string"==typeof t)return bt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?bt(t,e):void 0}}function bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function St(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,jt(n.key),n)}}function xt(t,e,r){return e&&St(t.prototype,e),r&&St(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ot(t,e,r){return(e=jt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function jt(t){var e=function(t,e){if("object"!==ft(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ft(e)?e:String(e)}var Et=function(){function t(e){wt(this,t),Ot(this,"subscriber",void 0),Ot(this,"loadedPromise",void 0),this.subscriber=e}return xt(t,[{key:"load",value:function(t){"function"!=typeof this.subscriber&&(this.loadedPromise=Promise.resolve(this.subscriber.load(t)))}},{key:"process",value:function(t){var e=this.subscriber;if("function"==typeof e)e(t);else{if(!this.loadedPromise)throw new Error("load() must be called before process()");this.loadedPromise.then((function(){return e.process(t)}))}}}]),t}(),kt=function(){function t(e){wt(this,t),Ot(this,"subscribers",new Set),Ot(this,"middlewares",new Set),Ot(this,"signalQueue",[]),Ot(this,"startedCtx",void 0),null!=e&&e.middleware&&this.addMiddleware.apply(this,gt(e.middleware))}var e,r;return xt(t,[{key:"start",value:(e=dt().mark((function t(e){var r;return dt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.startedCtx){t.next=2;break}return t.abrupt("return",this);case 2:return t.next=4,Promise.all(gt(this.middlewares).map((function(t){return t.load(e)})));case 4:for(this.subscribers.forEach((function(t){t.load(e)})),this.startedCtx=e;this.signalQueue.length>0;)r=this.signalQueue.shift(),this.processAndEmit(r);return t.abrupt("return",this);case 8:case"end":return t.stop()}}),t,this)})),r=function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(t){vt(i,n,o,a,u,"next",t)}function u(t){vt(i,n,o,a,u,"throw",t)}a(void 0)}))},function(t){return r.apply(this,arguments)})},{key:"emit",value:function(t){this.startedCtx?this.processAndEmit(t):this.signalQueue.push(t)}},{key:"addMiddleware",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.forEach((function(e){t.startedCtx&&e.load(t.startedCtx),t.middlewares.add(e)})),this}},{key:"removeMiddleware",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.forEach((function(e){return t.middlewares.delete(e)})),this}},{key:"subscribe",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.map((function(t){return new Et(t)})).forEach((function(e){t.subscribers.has(e)||(t.startedCtx&&e.load(t.startedCtx),t.subscribers.add(e))})),this}},{key:"unsubscribe",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.forEach((function(e){var r=gt(t.subscribers).find((function(t){return t.subscriber===e}));r&&t.subscribers.delete(r)})),this}},{key:"processAndEmit",value:function(t){var e,r=yt(this.middlewares);try{for(r.s();!(e=r.n()).done;){if(null===e.value.process(t))return}}catch(t){r.e(t)}finally{r.f()}var n,o=yt(this.subscribers);try{for(o.s();!(n=o.n()).done;){var i=n.value,a=ht({},t);i.process(a)}}catch(t){o.e(t)}finally{o.f()}}}]),t}(),Lt=function(){function t(t){var e;this.callbacks={},this.warned=!1,this.maxListeners=null!==(e=null==t?void 0:t.maxListeners)&&void 0!==e?e:10}return t.prototype.warnIfPossibleMemoryLeak=function(t){this.warned||this.maxListeners&&this.callbacks[t].length>this.maxListeners&&(console.warn("Event Emitter: Possible memory leak detected; ".concat(String(t)," has exceeded ").concat(this.maxListeners," listeners.")),this.warned=!0)},t.prototype.on=function(t,e){return this.callbacks[t]?(this.callbacks[t].push(e),this.warnIfPossibleMemoryLeak(t)):this.callbacks[t]=[e],this},t.prototype.once=function(t,e){var r=this;return this.on(t,(function n(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];r.off(t,n),e.apply(r,o)})),this},t.prototype.off=function(t,e){var r,n=(null!==(r=this.callbacks[t])&&void 0!==r?r:[]).filter((function(t){return t!==e}));return this.callbacks[t]=n,this},t.prototype.emit=function(t){for(var e,r=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var i=null!==(e=this.callbacks[t])&&void 0!==e?e:[];return i.forEach((function(t){t.apply(r,n)})),this},t}();function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function Pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Tt(n.key),n)}}function It(t,e,r){return(e=Tt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Tt(t){var e=function(t,e){if("object"!==_t(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==_t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===_t(e)?e:String(e)}var Ct=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),It(this,"emitter",new Lt),It(this,"pollInterval",500),It(this,"urlChanged",void 0),this.pollURLChange()}var e,r,n;return e=t,(r=[{key:"pollURLChange",value:function(){var t=this,e=window.location.href;setInterval((function(){var r=window.location.href;r!=e&&(t.emitter.emit("change",e),e=r)}),this.pollInterval)}},{key:"subscribe",value:function(t){this.urlChanged=t,this.emitter.on("change",this.urlChanged)}},{key:"unsubscribe",value:function(){this.emitter.off("change",this.urlChanged)}}])&&Pt(e.prototype,r),n&&Pt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function At(t){return At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},At(t)}function Nt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ft(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Nt(Object(r),!0).forEach((function(e){Gt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Nt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Gt(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==At(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==At(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===At(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Mt=function(t,e){return{timestamp:(new Date).toISOString(),anonymousId:"",type:t,data:Ft(Ft({},e),{},{page:{path:location.pathname,referrer:document.referrer,title:document.title,search:location.search,url:location.href,hostname:location.hostname,hash:location.hash}})}},Dt=function(t){return Mt("interaction",t)},Ht=function(t){return Mt("navigation",t)},Rt=function(t,e){return Ft(Ft({},Mt("network",Ft(Ft({},t),{},{url:(r=t.url,r.startsWith("http")?r:r.startsWith("/")?window.location.origin+r:r.includes(".")?"".concat(location.protocol,"//").concat(r):window.location.origin+"/"+r)}))),{},{metadata:null!=e?e:{filters:{allowed:[],disallowed:[]}}});var r},Bt=function(t){return t.replace(/[\r\n\t]+/g," ").replace(/\s\s+/g," ").replace(/\u00A0/g," ").trim()};function Yt(t){return Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yt(t)}function Kt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function zt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Kt(Object(r),!0).forEach((function(e){Zt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Kt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Zt(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Yt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Yt(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Xt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(t,e)||qt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wt(t){return function(t){if(Array.isArray(t))return Vt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||qt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qt(t,e){if(t){if("string"==typeof t)return Vt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Vt(t,e):void 0}}function Vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Ut=function(t){var e=t.textContent?Bt(t.textContent):"";return{id:t.id,attributes:Jt(t.attributes),textContent:e}},Jt=function(t){return Array.from(t).reduce((function(t,e){return"string"!=typeof e.value&&null!==e.value||(t[e.name]=e.value),t}),{})},Qt=function(t,e){var r,n=t.getAttribute(e);if(n)return null!==(r=document.getElementById(n))&&void 0!==r?r:void 0},$t=function(t){var e,r,n,o=function(t){return t?Wt(t).map(Ut).filter((function(t){return Boolean(t)})):[]}(t.labels),i=Qt(t,"aria-labelledby"),a=Qt(t,"aria-describedby");if(i){var u=Ut(i);o.unshift(u)}var c,s=function(e){if(e in t){var r=t[e];return"string"==typeof r?r:void 0}},l={attributes:Jt(t.attributes),classList:Wt(t.classList),id:s("id")||"",labels:o,label:o[0],name:s("name"),nodeName:t.nodeName,tagName:t.tagName,title:s("title")||"",type:s("type"),value:s("value"),textContent:null!==(e=t.textContent&&Bt(t.textContent))&&void 0!==e?e:void 0,innerText:null!==(r=t.innerText&&Bt(t.innerText))&&void 0!==r?r:void 0,describedBy:null!==(n=a&&Ut(a))&&void 0!==n?n:void 0};return t instanceof HTMLSelectElement?zt(zt({},l),{},{selectedOptions:Wt(t.selectedOptions).map((function(t){return{value:t.value,label:t.label}})),selectedIndex:t.selectedIndex}):t instanceof HTMLInputElement?zt(zt({},l),{},{checked:t.checked}):t instanceof HTMLMediaElement?zt(zt({},l),{},{currentSrc:t.currentSrc,currentTime:t.currentTime,duration:t.duration,ended:t.ended,muted:t.muted,paused:t.paused,playbackRate:t.playbackRate,readyState:t.readyState,src:t.src,volume:t.volume}):t instanceof HTMLFormElement?zt(zt({},l),{},{innerText:void 0,textContent:void 0,formData:(c=new FormData(t),Wt(c).reduce((function(t,e){var r=Xt(e,2),n=r[0],o=r[1];return"string"==typeof o&&(t[n]=o),t}),{}))}):l};function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function re(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ee(Object(r),!0).forEach((function(e){ae(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ne(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ue(n.key),n)}}function ie(t,e,r){return e&&oe(t.prototype,e),r&&oe(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function ae(t,e,r){return(e=ue(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ue(t){var e=function(t,e){if("object"!==te(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===te(e)?e:String(e)}var ce=function(){function t(){ne(this,t),ae(this,"id","click")}return ie(t,[{key:"register",value:function(t){var e=this,r=function(r){var n=r.target;if(n){var o=e.getClosestClickableElement(n);o&&t.emit(Dt({eventType:"click",target:$t(o)}))}};return document.addEventListener("click",r,!0),function(){return document.removeEventListener("click",r)}}},{key:"getClosestClickableElement",value:function(t){var e=["button","a","option",'[role="button"]','[role="link"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="tab"]','[role="option"]','[role="switch"]','[role="treeitem"]'].join(", ");return t.closest(e)}}]),t}(),se=function(){function t(){ne(this,t),ae(this,"id","form-submit")}return ie(t,[{key:"register",value:function(t){var e=function(e){var r=e.target;if(r){var n=e.submitter;t.emit(Dt({eventType:"submit",target:$t(r),submitter:n?$t(n):void 0}))}};return document.addEventListener("submit",e,!0),function(){return document.removeEventListener("submit",e)}}}]),t}(),le=function(t){return t instanceof HTMLInputElement&&"password"===t.type},fe=function(){function t(){ne(this,t),ae(this,"id","navigation")}return ie(t,[{key:"register",value:function(t){var e=this;t.emit(Ht(re({action:"pageLoad"},this.createCommonFields())));var r=new Ct;return r.subscribe((function(r){return t.emit(Ht(re({action:"urlChange",prevUrl:r},e.createCommonFields())))})),function(){r.unsubscribe()}}},{key:"createCommonFields",value:function(){return{url:location.href,path:location.pathname,hash:location.hash,search:location.search,title:document.title}}}]),t}(),pe=function(t){return null!=t&&void 0!==t};function he(t){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},he(t)}function ye(t){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ye(t)}function de(t,e){return de=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},de(t,e)}function ve(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=me(t);if(e){var o=me(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ge(this,r)}}function ge(t,e){if(e&&("object"===ye(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function me(t){return me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},me(t)}function be(t){return function(t){if(Array.isArray(t))return we(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return we(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return we(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function we(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Se(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function xe(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Se(Object(r),!0).forEach((function(e){ke(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Se(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Oe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Le(n.key),n)}}function je(t,e,r){return e&&Oe(t.prototype,e),r&&Oe(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ke(t,e,r){return(e=Le(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Le(t){var e=function(t,e){if("object"!==ye(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ye(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ye(e)?e:String(e)}var _e=["aria-pressed","aria-checked","aria-modal","aria-selected","value","checked","data-selected"],Pe=["input","label","option","select","textarea"],Ie=["button","checkbox","dialog","gridcell","row","searchbox","menuitemcheckbox","menuitemradio","option","radio","scrollbar","slider","spinbutton","switch","tab","treeitem"],Te=je((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ee(this,t),ke(this,"pollIntervalMs",void 0),ke(this,"debounceMs",void 0),ke(this,"emitInputStrategy",void 0),ke(this,"extraSelectors",void 0),ke(this,"observedRoles",void 0),ke(this,"observedTags",void 0),ke(this,"observedAttributes",void 0);var r=e.pollIntervalMs,n=void 0===r?400:r,o=e.debounceMs,i=void 0===o?1e3:o,a=e.emitInputStrategy,u=void 0===a?"debounce-only":a,c=e.extraSelectors,s=void 0===c?[]:c,l=e.observedRoles,f=e.observedTags,p=e.observedAttributes;if(n<300)throw new Error("Poll interval must be at least 300ms");this.emitInputStrategy=u,this.pollIntervalMs=n,this.debounceMs=i,this.extraSelectors=s,this.observedRoles=l?l(Ie):Ie,this.observedTags=f?f(Pe):Pe,this.observedAttributes=p?p(_e):_e})),Ce=function(){function t(e){var r=this;Ee(this,t),ke(this,"settings",void 0),ke(this,"observedElements",new WeakSet),ke(this,"prevMutationsCache",new WeakMap),ke(this,"emitter",new Ne),ke(this,"listeners",new Set),ke(this,"pollTimeout",void 0),ke(this,"experimentalOnChangeAdapter",new Ae),this.settings=null!=e?e:new Te,this.checkForNewElements(this.emitter),this.pollTimeout=setInterval((function(){return r.checkForNewElements(r.emitter)}),this.settings.pollIntervalMs)}return je(t,[{key:"subscribe",value:function(t){this.listeners.add(t),this.emitter.on("attributeChanged",t)}},{key:"cleanup",value:function(){var t=this;this.listeners.forEach((function(e){return t.emitter.off("attributeChanged",e)})),this.listeners.clear(),clearInterval(this.pollTimeout)}},{key:"shouldEmitEvent",value:function(t,e){return"aria-selected"!==t||"false"!==e}},{key:"observeElementAttributes",value:function(t,e,r){var n=this;if(t instanceof HTMLElement){var o,i,a,u,c=function(e){r.emit("attributeChanged",{element:t,attributes:e})},s="blur"===this.settings.emitInputStrategy?function(e){return n.experimentalOnChangeAdapter.onBlur(t,(function(){return c(e)}))}:c,l=function(t){var e=new Set(["text","password","email","url","tel","number","search","date","time","datetime-local","month","week","color","range",null]),r=new Set(["spinbutton"]),n=t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement;if(t.isContentEditable)return!0;if(!n)return!1;var o=t.getAttribute("type");if(e.has(o))return!0;var i=t.getAttribute("role");return!(!i||!r.has(i))}(t)?(o=s,i=function(t){return Object.keys(t).sort()},a=this.settings.debounceMs,u=new Map,function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=i.apply(void 0,e),c="object"===he(n)?JSON.stringify(n):n;u.has(c)&&clearTimeout(u.get(c));var s=setTimeout((function(){u.delete(c),o.apply(void 0,e)}),a);u.set(c,s)}):c;new MutationObserver((function(e){var r=e.filter((function(t){return"attributes"===t.type})).map((function(t){var e=t.attributeName,r=t.target;if(e&&r&&r instanceof HTMLElement){var n=r.getAttribute(e),o={attributeName:e,newValue:n};return J.debug("Attribute mutation",{newValue:n,oldValue:t.oldValue,target:t.target}),o}})).filter(pe).filter((function(t){return n.shouldEmitEvent(t.attributeName,t.newValue)})).reduce((function(t,e){return t[e.attributeName]=e.newValue,t}),{});if(!(0===Object.keys(r).length)){var o,i,a=n.prevMutationsCache.get(t);if(a)if(!(o=r,i=a,!Object.keys(o).every((function(t){return o[t]===i[t]}))))return;n.prevMutationsCache.set(t,xe(xe({},a),r)),l(r)}})).observe(t,{attributes:!0,attributeFilter:e,subtree:!1}),this.observedElements.add(t)}}},{key:"checkForNewElements",value:function(t){var e=this;[].concat(be(this.settings.observedRoles.map((function(t){return'[role="'.concat(t,'"]')}))),be(this.settings.observedTags),be(this.settings.extraSelectors)).forEach((function(r){document.querySelectorAll(r).forEach((function(r){e.observedElements.has(r)||(J.debug("Observing element",r),e.observeElementAttributes(r,e.settings.observedAttributes,t))}))}))}}]),t}(),Ae=function(){function t(){Ee(this,t),ke(this,"inputListeners",new Map)}return je(t,[{key:"removeListener",value:function(t){var e=this.inputListeners.get(t);e&&t.removeEventListener("blur",e)}},{key:"onBlur",value:function(t,e){this.removeListener(t),t.addEventListener("blur",e,{once:!0}),t.addEventListener("keydown",(function(t){"Enter"===t.key&&e()}),{once:!0}),this.inputListeners.set(t,e)}}]),t}(),Ne=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&de(t,e)}(r,t);var e=ve(r);function r(){return Ee(this,r),e.apply(this,arguments)}return je(r)}(Lt);function Fe(t){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fe(t)}function Ge(t,e,r){return(e=He(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,He(n.key),n)}}function De(t,e,r){return e&&Me(t.prototype,e),r&&Me(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function He(t){var e=function(t,e){if("object"!==Fe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Fe(e)?e:String(e)}function Re(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Be(t,e){return Be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Be(t,e)}function Ye(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ze(t);if(e){var o=ze(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ke(this,r)}}function Ke(t,e){if(e&&("object"===Fe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ze(t){return ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ze(t)}var Ze,Xe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Be(t,e)}(r,t);var e=Ye(r);function r(){return Re(this,r),e.apply(this,arguments)}return De(r)}(Te),We=[function(){function t(e){Re(this,t),Ge(this,"id","mutation"),Ge(this,"elMutObserver",void 0),Ge(this,"customSelectors",[]),this.elMutObserver=new Ce(e.mutationGenerator)}return De(t,[{key:"register",value:function(t){var e=this;return this.elMutObserver.subscribe((function(e){var r=e.element;if(r&&!le(r)){var n=$t(e.element);t.emit(Dt({eventType:"change",target:n,listener:"mutation",change:e.attributes}))}})),function(){return e.elMutObserver.cleanup()}}}]),t}(),function(){function t(){Re(this,t),Ge(this,"id","change")}return De(t,[{key:"register",value:function(t){var e=function(e){var r=e.target;if(r&&!le(r))if(function(t){var e=t.getAttribute("type");return!(!(t instanceof HTMLInputElement)||null!==e&&!["text","password","email","url","tel","number","search","date","time","datetime-local","month","week","color","range"].includes(e))&&null!==t.getAttribute("value")}(r))J.debug("Ignoring onchange event in stateful element",r);else{var n=$t(r),o=function(t){if(t instanceof HTMLSelectElement)return{selectedOptions:Array.from(t.selectedOptions).map((function(t){return{value:t.value,label:t.label}}))};if(t instanceof HTMLTextAreaElement)return{value:t.value};var e;if(t instanceof HTMLInputElement&&("value"in t||"checked"in t))return"checkbox"===t.type||"radio"===t.type?{checked:t.checked}:"file"===t.type?{files:Array.from(null!==(e=t.files)&&void 0!==e?e:[]).map((function(t){return t.name}))}:{value:t.value}}(r);o?t.emit(Dt({eventType:"change",listener:"onchange",target:n,change:o})):J.debug("No change found on element..., this should not happen",n)}};return document.addEventListener("change",e,!0),function(){document.removeEventListener("change",e,!0)}}}]),t}(),function(){function t(){Re(this,t),Ge(this,"id","contenteditable")}return De(t,[{key:"register",value:function(t){var e=function(e){if(e.target instanceof HTMLElement){var r=e.target,n=$t(r);t.emit(Dt({eventType:"change",listener:"contenteditable",target:n,change:{textContent:n.textContent||null}}))}},r=function(t){var r=t.target;r instanceof HTMLElement&&r.isContentEditable&&r.addEventListener("blur",e,{once:!0})};return document.addEventListener("input",r,!0),function(){return document.removeEventListener("input",r)}}}]),t}(),ce,se,fe],qe=function(t){var e=t.replace("www.","").split("."),r=2;return["co","com","org","eu"].includes(e[e.length-2])&&(r=3),e.slice(-r).join(".")},Ve=function(t){return t instanceof Headers?t:new Headers(t)},Ue=function(t,e){if(!t)return!1;var r=Ve(t);return e.some((function(t){var e;return null===(e=r.get("content-type"))||void 0===e?void 0:e.includes(t)}))},Je=function(t){return Ue(t,["application/json","application/ld+json","text/json"])},Qe=function(t){return t>=200&&t<300},$e=function(t){try{return JSON.parse(t)}catch(e){return t}},tr=function(t){return"string"==typeof t?t:"url"in t?t.url:t.toString()},er=function(){return Math.random().toString(36).substring(3)};function rr(t){return rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rr(t)}function nr(){return nr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=or(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},nr.apply(this,arguments)}function or(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=sr(t)););return t}function ir(t,e){return ir=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ir(t,e)}function ar(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=sr(t);if(e){var o=sr(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ur(this,r)}}function ur(t,e){if(e&&("object"===rr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return cr(t)}function cr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function sr(t){return sr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sr(t)}function lr(t,e,r){return(e=gr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fr(){fr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==rr(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(rr(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function pr(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function hr(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){pr(i,n,o,a,u,"next",t)}function u(t){pr(i,n,o,a,u,"throw",t)}a(void 0)}))}}function yr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,gr(n.key),n)}}function vr(t,e,r){return e&&dr(t.prototype,e),r&&dr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function gr(t){var e=function(t,e){if("object"!==rr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==rr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===rr(e)?e:String(e)}var mr=function(t){return t.toUpperCase()},br=function(t){var e,r=t.url,n=t.body,o=t.headers,i=t.id,a=t.method;return{url:r.toString(),method:a,headers:null!=o?o:new Headers,contentType:null!==(e=null==o?void 0:o.get("content-type"))&&void 0!==e?e:void 0,body:"string"==typeof n?n:void 0,id:i}},wr=function(t){var e=t.body,r=t.headers,n=t.initiator,o=t.status,i=t.statusText,a=t.url,u=t.responseType,c=t.id;return{body:e,headers:r,initiator:n,ok:Qe(o),status:o,statusText:i,url:a,responseType:u,req:{id:c}}},Sr=function(){function t(){yr(this,t)}return vr(t,[{key:"addInterceptors",value:function(t,e){this.addFetchInterceptor(t,e),this.addXhrInterceptor(t,e)}},{key:"addFetchInterceptor",value:function(t,e){window.fetch&&(Ze=window.fetch,window.fetch=hr(fr().mark((function r(){var n,o,i,a,u,c,s,l,f,p,h,y=arguments;return fr().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(n=y.length,o=new Array(n),i=0;i<n;i++)o[i]=y[i];a=o[0],u=o[1],c=er();try{s=tr(a),l=null!=u&&u.headers?Ve(u.headers):void 0,t(br({url:s,body:"string"==typeof(null==u?void 0:u.body)?u.body:void 0,method:null!=u&&u.method?mr(u.method):"GET",headers:l,id:c}))}catch(t){console.log("Error handling request: ",t)}return r.next=6,Ze.apply(void 0,o);case 6:f=r.sent,p=f.clone();try{h=function(){var t=hr(fr().mark((function t(){var e;return fr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,p.text();case 3:e=t.sent,t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),console.warn("Error converting to text",t.t0,p),t.abrupt("return",null);case 10:return t.abrupt("return",$e(e));case 11:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}(),e(wr({body:h,headers:p.headers,initiator:"fetch",status:p.status,statusText:p.statusText,url:p.url,responseType:void 0,id:c}))}catch(t){console.log("Error handling response: ",t)}return r.abrupt("return",f);case 10:case"end":return r.stop()}}),r)}))))}},{key:"addXhrInterceptor",value:function(t,e){if(window.XMLHttpRequest){var r=function(r){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ir(t,e)}(o,r);var n=ar(o);function o(){var r;return yr(this,o),lr(cr(r=n.call(this)),"_reqURL",void 0),lr(cr(r),"_reqMethod",void 0),lr(cr(r),"_reqBody",void 0),lr(cr(r),"_reqHeaders",void 0),lr(cr(r),"_reqId",er()),r.addEventListener("readystatechange",(function(){if(r.readyState===r.HEADERS_RECEIVED)try{t(br({url:r._reqURL,method:r._reqMethod,headers:r._reqHeaders,id:r._reqId,body:r._reqBody?r._reqBody.toString():void 0}))}catch(t){console.log("Error handling request",t)}if(r.readyState===r.DONE)try{e(wr({status:r.status,responseType:r.responseType,statusText:r.statusText,url:r.responseURL,initiator:"xhr",body:function(){return Promise.resolve(r.getParsedXHRBody())},headers:r.getParsedXHRHeaders(r.getAllResponseHeaders()),id:r._reqId}))}catch(t){console.log("Error handling response",t)}})),r}return vr(o,[{key:"getParsedXHRHeaders",value:function(t){var e=new Headers;return t.trim().split(/[\r\n]+/).forEach((function(t){var r=t.split(": "),n=r.shift(),o=r.join(": ");n&&e.append(n,o)})),e}},{key:"getParsedXHRBody",value:function(){return"json"===this.responseType?this.response:"string"==typeof this.response?$e(this.response):null}},{key:"open",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r[0],a=r[1];try{this._reqURL=a.toString(),this._reqMethod=mr(i)}catch(t){console.log("Error handling request (open)",t)}(t=nr(sr(o.prototype),"open",this)).call.apply(t,[this].concat(r))}))},{key:"send",value:function(t){this._reqBody=t,nr(sr(o.prototype),"send",this).call(this,t)}},{key:"setRequestHeader",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];try{var i=r[0],a=r[1];this._reqHeaders||(this._reqHeaders=new Headers),this._reqHeaders.append(i,a)}catch(t){console.log("Error handling request (setRequestHeader)",t)}(t=nr(sr(o.prototype),"setRequestHeader",this)).call.apply(t,[this].concat(r))}))}]),o}(window.XMLHttpRequest);window.XMLHttpRequest=r}}},{key:"cleanup",value:function(){Ze&&(window.fetch=Ze)}}]),t}();function xr(t){return xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xr(t)}function Or(){Or=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==xr(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(xr(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function jr(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Lr(n.key),n)}}function kr(t,e,r){return(e=Lr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Lr(t){var e=function(t,e){if("object"!==xr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==xr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===xr(e)?e:String(e)}var _r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),kr(this,"id","network"),kr(this,"interceptor",new Sr),kr(this,"emittedRequestIds",[])}var e,r,n;return e=t,r=[{key:"register",value:function(t){var e=this,r=function(){var r,n=(r=Or().mark((function r(n){var o,i,a,u;return Or().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=n.ok&&"json"!==n.responseType&&!Je(n.headers),i=!n.ok&&!e.emittedRequestIds.includes(n.req.id),!o&&!i){r.next=4;break}return r.abrupt("return");case 4:if(a=n.url){r.next=7;break}return r.abrupt("return");case 7:return r.next=9,n.body();case 9:u=r.sent,t.emit(Rt({action:"response",url:a,data:u,ok:n.ok,status:n.status,contentType:n.headers.get("content-type")||""}));case 11:case"end":return r.stop()}}),r)})),function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){jr(i,n,o,a,u,"next",t)}function u(t){jr(i,n,o,a,u,"throw",t)}a(void 0)}))});return function(t){return n.apply(this,arguments)}}();return this.interceptor.addInterceptors((function(r){var n;if(r.url){var o="string"==typeof r.body?$e(r.body):null;e.emittedRequestIds.push(r.id),t.emit(Rt({action:"request",url:r.url,method:r.method||"GET",data:o,contentType:(null===(n=r.headers)||void 0===n?void 0:n.get("content-type"))||""}))}}),r),function(){e.interceptor.cleanup(),J.debug("Removing fetch interceptor")}}}],r&&Er(e.prototype,r),n&&Er(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Pr(t){return Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pr(t)}function Ir(){Ir=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Pr(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Pr(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function Tr(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}var Cr=function(){var t,e=(t=Ir().mark((function t(e,r,n){var o,i;return Ir().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=function(t){return J.debug("Registering generator:",t.id||t.name),"function"==typeof(r=t)&&void 0!==r.prototype.constructor?new t(n).register(e):t.register(e);var r},t.next=3,Promise.all(r.map(o));case 3:return i=t.sent,t.abrupt("return",(function(){return i.forEach((function(t){return t()}))}));case 5:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Tr(i,n,o,a,u,"next",t)}function u(t){Tr(i,n,o,a,u,"throw",t)}a(void 0)}))});return function(t,r,n){return e.apply(this,arguments)}}();function Ar(t){return Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ar(t)}function Nr(){Nr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Ar(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ar(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function Fr(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Gr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Dr(n.key),n)}}function Mr(t,e,r){return(e=Dr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Dr(t){var e=function(t,e){if("object"!==Ar(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Ar(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Ar(e)?e:String(e)}var Hr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Mr(this,"instance",void 0),Mr(this,"edgeFnSettings",void 0),this.instance=e,this.edgeFnSettings=this.parseEdgeFnSettings(e.settings.cdnSettings)}var e,r,n;return e=t,r=[{key:"parseEdgeFnSettings",value:function(t){var e=t.edgeFunction;if(e&&"downloadURL"in e)return e}},{key:"createSegmentInstrumentationEventGenerator",value:function(){var t,e,r=this,n=!1,o={id:"segment-event-generator",register:(t=Nr().mark((function t(e){return Nr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.instance.addSourceMiddleware((function(t){var r,o=t.payload,i=t.next;if(!n){var a=o.obj;return"Signal"===(null===(r=a.context.__eventOrigin)||void 0===r?void 0:r.type)||e.emit(Mt("instrumentation",{rawEvent:a})),i(o)}}));case 2:return t.abrupt("return",(function(){n=!0}));case 3:case"end":return t.stop()}}),t)})),e=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Fr(i,n,o,a,u,"next",t)}function u(t){Fr(i,n,o,a,u,"throw",t)}a(void 0)}))},function(t){return e.apply(this,arguments)})};return o}}],r&&Gr(e.prototype,r),n&&Gr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Rr(t){return Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rr(t)}function Br(t){return function(t){if(Array.isArray(t))return Yr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Yr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yr(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Kr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Wr(n.key),n)}}function zr(t,e,r){return e&&Kr(t.prototype,e),r&&Kr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Zr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xr(t,e,r){return(e=Wr(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Wr(t){var e=function(t,e){if("object"!==Rr(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Rr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Rr(e)?e:String(e)}var qr=zr((function t(e){var r=e.networkSignalsAllowList,n=e.networkSignalsDisallowList,o=e.networkSignalsAllowSameDomain;Zr(this,t),Xr(this,"networkSignalsAllowSameDomain",void 0),Xr(this,"networkSignalsFilterList",void 0),this.networkSignalsAllowSameDomain=null==o||o,this.networkSignalsFilterList=new Ur(r,n)})),Vr=function(){function t(e){Zr(this,t),Xr(this,"regexes",void 0),this.regexes=e}return zr(t,[{key:"combinedRegex",get:function(){return new RegExp(this.regexes.map((function(t){return"string"==typeof(e=t)?new RegExp(e):e;var e})).map((function(t){return t.source})).join("|"))}},{key:"test",value:function(t){return!!this.regexes.length&&this.combinedRegex.test(t)}},{key:"add",value:function(){var t;(t=this.regexes).push.apply(t,arguments)}},{key:"addURLLike",value:function(){for(var t=this,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=r.map((function(e){return t.urlToRegex(e)})).filter((function(t){return Boolean(t)}));this.add.apply(this,Br(o))}},{key:"urlToRegex",value:function(t){var e=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");try{return new RegExp(e)}catch(t){console.error("Invalid regex: ".concat(e),t)}}}]),t}(),Ur=function(){function t(e,r){Zr(this,t),Xr(this,"allowed",void 0),Xr(this,"disallowed",void 0),Xr(this,"disallowedDefaults",void 0),this.allowed=new Vr(e||[]),this.disallowed=new Vr(r||[]),this.disallowedDefaults=new Vr(["api.segment.io","signals.segment.io","cdn.segment.com"])}return zr(t,[{key:"isDisallowed",value:function(t){return this.disallowed.test(t)||this.disallowedDefaults.test(t)}},{key:"isAllowed",value:function(t){return this.allowed.test(t)}},{key:"getRegexes",value:function(){return{allowed:this.allowed.regexes.map((function(t){return t.toString()})),disallowed:this.disallowed.regexes.map((function(t){return t.toString()}))}}}]),t}(),Jr=function(){function t(e){Zr(this,t),Xr(this,"settings",void 0),this.settings=e}return zr(t,[{key:"isAllowed",value:function(t){var e=this.settings,r=e.networkSignalsFilterList,n=e.networkSignalsAllowSameDomain;if(r.isDisallowed(t))return!1;var o=r.isAllowed(t)||n&&function(t){if(!new RegExp("^(?:[a-z+]+:)?//","i").test(t))return!0;var e=new URL(t).hostname;return qe(e)===qe(window.location.hostname)}(t);return o}}]),t}(),Qr=function(){function t(){var e=this;Zr(this,t),Xr(this,"filter",void 0),Xr(this,"createMetadata",(function(){return{filters:e.filter.settings.networkSignalsFilterList.getRegexes()}}))}return zr(t,[{key:"load",value:function(t){this.filter=new Jr(t.unstableGlobalSettings.network)}},{key:"process",value:function(t){return"network"===t.type?(t.metadata=this.createMetadata(),this.filter.isAllowed(t.data.url)?t:null):t}}]),t}();function $r(t){return $r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$r(t)}function tn(t){return function(t){if(Array.isArray(t))return en(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return en(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return en(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function en(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function rn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,un(n.key),n)}}function on(t,e,r){return e&&nn(t.prototype,e),r&&nn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function an(t,e,r){return(e=un(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function un(t){var e=function(t,e){if("object"!==$r(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==$r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===$r(e)?e:String(e)}var cn=function(){function t(e){var r=this;if(rn(this,t),an(this,"sandbox",void 0),an(this,"signalBuffer",void 0),an(this,"ingestClient",void 0),an(this,"network",void 0),an(this,"signalsDebug",void 0),an(this,"mutationGenerator",void 0),an(this,"sampleSuccess",!1),e.maxBufferSize&&e.signalStorage)throw new Error("maxBufferSize and signalStorage cannot be defined at the same time");this.mutationGenerator=new Xe({extraSelectors:e.mutationGenExtraSelectors,observedRoles:e.mutationGenObservedRoles,observedTags:e.mutationGenObservedTags,pollIntervalMs:e.mutationGenPollInterval,observedAttributes:e.mutationGenObservedAttributes}),this.signalsDebug=new sn(e.disableSignalsRedaction,e.enableSignalsIngestion),this.signalBuffer={signalStorage:e.signalStorage,storageType:e.signalStorageType,maxBufferSize:e.maxBufferSize},this.ingestClient={apiHost:e.apiHost,flushAt:e.flushAt,flushInterval:e.flushInterval,shouldDisableSignalsRedaction:this.signalsDebug.getDisableSignalsRedaction,shouldIngestSignals:function(){return!!r.signalsDebug.getEnableSignalsIngestion()||!!r.sampleSuccess}},this.sandbox={functionHost:e.functionHost,processSignal:e.processSignal,edgeFnDownloadURL:void 0},this.network=new qr({networkSignalsAllowList:e.networkSignalsAllowList,networkSignalsDisallowList:e.networkSignalsDisallowList,networkSignalsAllowSameDomain:e.networkSignalsAllowSameDomain})}return on(t,[{key:"update",value:function(t){var e,r=t.edgeFnDownloadURL,n=t.disallowListURLs,o=t.sampleRate;r&&(this.sandbox.edgeFnDownloadURL=r),(e=this.network.networkSignalsFilterList.disallowed).addURLLike.apply(e,tn(n.filter((function(t){return Boolean(t)})))),this.sampleSuccess=this.checkSampleRate(null!=o?o:0)}},{key:"checkSampleRate",value:function(t){var e=new K(window.sessionStorage),r=e.getItem("segment_sample_success");return void 0!==r?r:t&&Math.random()<=t?(e.setItem("segment_sample_success",!0),!0):(e.setItem("segment_sample_success",!1),!1)}}]),t}(),sn=on((function t(e,r){var n=this;rn(this,t),an(this,"storage",new K(window.sessionStorage)),an(this,"setAllDebugging",(function(e){n.storage.setItem(t.redactionKey,e),n.storage.setItem(t.ingestionKey,e)})),an(this,"getDisableSignalsRedaction",(function(){var e;return null!==(e=n.storage.getItem(t.redactionKey))&&void 0!==e&&e})),an(this,"getEnableSignalsIngestion",(function(){var e;return null!==(e=n.storage.getItem(t.ingestionKey))&&void 0!==e&&e})),"boolean"==typeof e&&this.storage.setItem(t.redactionKey,e),"boolean"==typeof r&&this.storage.setItem(t.ingestionKey,r);var o=M();J.debug("debugMode is set to true via query string"),"boolean"==typeof o&&this.setAllDebugging(o)}));an(sn,"redactionKey","segment_signals_debug_redaction_disabled"),an(sn,"ingestionKey","segment_signals_debug_ingestion_enabled");var ln=o(51),fn=o(322);function pn(t,e,r,n){var o,i=[t,e,r,n],a=(0,fn.Qd)(t)?t.event:t;if(!a||!(0,fn.Kg)(a))throw new Error("Event missing");var u=(0,fn.Qd)(t)?null!==(o=t.properties)&&void 0!==o?o:{}:(0,fn.Qd)(e)?e:{},c={};return(0,fn.Tn)(r)||(c=null!=r?r:{}),(0,fn.Qd)(t)&&!(0,fn.Tn)(e)&&(c=null!=e?e:{}),[a,u,c,i.find(fn.Tn)]}function hn(t,e,r,n,o){var i,a,u=null,c=null,s=[t,e,r,n,o],l=s.filter(fn.Kg);1===l.length?(0,fn.Kg)(s[1])?(c=s[1],u=null):(c=l[0],u=null):2===l.length&&("string"==typeof s[0]&&(u=s[0]),"string"==typeof s[1]&&(c=s[1]));var f=s.find(fn.Tn),p=s.filter(fn.Qd);return 1===p.length?(0,fn.Qd)(s[2])?(a={},i=s[2]):(0,fn.Qd)(s[3])?(i={},a=s[3]):(i=p[0],a={}):2===p.length&&(i=p[0],a=p[1]),[u,c,null!=i?i:i={},null!=a?a:a={},f]}var yn=function(t){return function(){for(var e,r,n,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];for(var a={},u=["callback","options","traits","id"],c=0,s=o;c<s.length;c++){var l=s[c],f=u.pop();if("id"===f){if((0,fn.Kg)(l)||(0,fn.Et)(l)){a.id=l.toString();continue}if(null==l)continue;f=u.pop()}if("traits"!==f&&"options"!==f||null!=l&&!(0,fn.Qd)(l)||(a[f]=l),(0,fn.Tn)(l)){a.callback=l;break}}return[null!==(e=a.id)&&void 0!==e?e:t.id(),null!==(r=a.traits)&&void 0!==r?r:{},null!==(n=a.options)&&void 0!==n?n:{},a.callback]}};function dn(t,e,r,n){(0,fn.Et)(t)&&(t=t.toString()),(0,fn.Et)(e)&&(e=e.toString());var o=[t,e,r,n],i=o.filter(fn.Kg),a=i[0],u=void 0===a?t:a,c=i[1],s=void 0===c?null:c,l=o.filter(fn.Qd)[0];return[u,s,void 0===l?{}:l,o.find(fn.Tn)]}function vn(){return"undefined"!=typeof window}function gn(){return!(!vn()||window.navigator.onLine)}var mn=o(760),bn=o(19);function wn(t,e){return e=e||{},new Promise((function(r,n){var o=new XMLHttpRequest,i=[],a=[],u={},c=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(JSON.parse(o.responseText))},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:c,headers:{keys:function(){return i},entries:function(){return a},get:function(t){return u[t.toLowerCase()]},has:function(t){return t.toLowerCase()in u}}}};for(var s in o.open(e.method||"get",t,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,e,r){i.push(e=e.toLowerCase()),a.push([e,r]),u[e]=u[e]?u[e]+","+r:r})),r(c())},o.onerror=n,o.withCredentials="include"==e.credentials,e.headers)o.setRequestHeader(s,e.headers[s]);o.send(e.body||null)}))}var Sn=function(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==o.g?o.g:null},xn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Sn();return(r&&r.fetch||wn).apply(void 0,t)},On="1.79.0",jn="npm";function En(){return jn}var kn="api.segment.io/v1";function Ln(t){console.error("Error sending segment performance metrics",t)}var _n,Pn=function(){function t(t){var e,r,n,o,i,a=this;if(this.host=null!==(e=null==t?void 0:t.host)&&void 0!==e?e:kn,this.sampleRate=null!==(r=null==t?void 0:t.sampleRate)&&void 0!==r?r:1,this.flushTimer=null!==(n=null==t?void 0:t.flushTimer)&&void 0!==n?n:3e4,this.maxQueueSize=null!==(o=null==t?void 0:t.maxQueueSize)&&void 0!==o?o:20,this.protocol=null!==(i=null==t?void 0:t.protocol)&&void 0!==i?i:"https",this.queue=[],this.sampleRate>0){var u=!1;!function t(){u||(u=!0,a.flush().catch(Ln),u=!1,setTimeout(t,a.flushTimer))}()}}return t.prototype.increment=function(t,e){if(t.includes("analytics_js.")&&0!==e.length&&!(Math.random()>this.sampleRate||this.queue.length>=this.maxQueueSize)){var r=function(t,e,r){var n=e.reduce((function(t,e){var r=e.split(":"),n=r[0],o=r[1];return t[n]=o,t}),{});return{type:"Counter",metric:t,value:1,tags:(0,ln.Cl)((0,ln.Cl)({},n),{library:"analytics.js",library_version:"web"===r?"next-".concat(On):"npm:next-".concat(On)})}}(t,e,En());this.queue.push(r),t.includes("error")&&this.flush().catch(Ln)}},t.prototype.flush=function(){return(0,ln.sH)(this,void 0,void 0,(function(){var t=this;return(0,ln.YH)(this,(function(e){switch(e.label){case 0:return this.queue.length<=0?[2]:[4,this.send().catch((function(e){Ln(e),t.sampleRate=0}))];case 1:return e.sent(),[2]}}))}))},t.prototype.send=function(){return(0,ln.sH)(this,void 0,void 0,(function(){var t,e,r;return(0,ln.YH)(this,(function(n){return t={series:this.queue},this.queue=[],e={"Content-Type":"text/plain"},r="".concat(this.protocol,"://").concat(this.host,"/m"),[2,xn(r,{headers:e,body:JSON.stringify(t),method:"POST"})]}))}))},t}(),In=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,ln.C6)(e,t),e.initRemoteMetrics=function(t){_n=new Pn(t)},e.prototype.increment=function(e,r,n){t.prototype.increment.call(this,e,r,n),null==_n||_n.increment(e,null!=n?n:[])},e}(bn.p),Tn=function(t){function e(e,r){return t.call(this,e,r,new In)||this}return(0,ln.C6)(e,t),e.system=function(){return new this({type:"track",event:"system"})},e}(mn.j),Cn=o(467);function An(t,e,r,n){return(0,ln.sH)(this,void 0,void 0,(function(){var o,i;return(0,ln.YH)(this,(function(a){switch(a.label){case 0:return r.emit("dispatch_start",t),o=Date.now(),e.isEmpty()?[4,e.dispatchSingle(t)]:[3,2];case 1:return i=a.sent(),[3,4];case 2:return[4,e.dispatch(t)];case 3:i=a.sent(),a.label=4;case 4:return(null==n?void 0:n.callback)?[4,(0,Cn.w_)(i,n.callback,(u=o,c=n.timeout,s=Date.now()-u,Math.max((null!=c?c:300)-s,0)))]:[3,6];case 5:i=a.sent(),a.label=6;case 6:return(null==n?void 0:n.debug)&&i.flush(),[2,i]}var u,c,s}))}))}var Nn=o(868);var Fn=function(t,e,r,n,o,i){return{__t:"bpc",c:e,p:n,u:t,s:r,t:o,r:i}},Gn=Object.keys(Fn("","","","","",""));var Mn=function(t){var e,r,n=t.c,o=t.p,i=t.s,a=t.u,u=t.r,c=t.t,s=n?function(t){try{return new URL(t).pathname}catch(e){return"/"===t[0]?t:"/"+t}}(n):o,l=n?function(t,e){return t.indexOf("?")>-1?t:t+e}(n,i):-1===(r=(e=a).indexOf("#"))?e:e.slice(0,r);return{path:s,referrer:u,search:i,title:c,url:l}},Dn=function(){var t=document.querySelector("link[rel='canonical']");return Fn(location.href,t&&t.getAttribute("href")||void 0,location.search,location.pathname,document.title,document.referrer)},Hn=function(t,e){void 0===e&&(e=Mn(Dn()));var r,n,o,i=t.context;"page"===t.type&&(r=t.properties&&(n=t.properties,o=Object.keys(e),Object.assign.apply(Object,(0,ln.fX)([{}],o.map((function(t){var e;if(n&&Object.prototype.hasOwnProperty.call(n,t))return(e={})[t]=n[t],e})),!1))),t.properties=(0,ln.Cl)((0,ln.Cl)((0,ln.Cl)({},e),t.properties),t.name?{name:t.name}:{})),i.page=(0,ln.Cl)((0,ln.Cl)((0,ln.Cl)({},e),r),i.page)},Rn=o(192),Bn=function(t){function e(e,r){var n=t.call(this,"".concat(e," ").concat(r))||this;return n.field=e,n}return(0,ln.C6)(e,t),e}(Error);function Yn(t){return Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yn(t)}var Kn="is not a string",zn="is not an object",Zn="is nil";function Xn(t){!function(t){if(!(0,fn.t2)(t))throw new Bn("Event",Zn);if("object"!==Yn(t))throw new Bn("Event",zn)}(t),function(t){if(!(0,fn.Kg)(t.type))throw new Bn(".type",Kn)}(t),function(t){if(!(0,fn.Kg)(t.messageId))throw new Bn(".messageId",Kn)}(t),"track"===t.type&&(function(t){if(!(0,fn.Kg)(t.event))throw new Bn(".event",Kn)}(t),function(t){if(!(0,fn.Qd)(t.properties))throw new Bn(".properties",zn)}(t)),["group","identify"].includes(t.type)&&function(t){if(!(0,fn.Qd)(t.traits))throw new Bn(".traits",zn)}(t)}var Wn=function(t){var e,r;this.settings=t,this.createMessageId=t.createMessageId,this.onEventMethodCall=null!==(e=t.onEventMethodCall)&&void 0!==e?e:function(){},this.onFinishedEvent=null!==(r=t.onFinishedEvent)&&void 0!==r?r:function(){}},qn=function(){function t(t){this.settings=new Wn(t)}return t.prototype.track=function(t,e,r,n){return this.settings.onEventMethodCall({type:"track",options:r}),this.normalize((0,ln.Cl)((0,ln.Cl)({},this.baseEvent()),{event:t,type:"track",properties:null!=e?e:{},options:(0,ln.Cl)({},r),integrations:(0,ln.Cl)({},n)}))},t.prototype.page=function(t,e,r,n,o){var i;this.settings.onEventMethodCall({type:"page",options:n});var a={type:"page",properties:(0,ln.Cl)({},r),options:(0,ln.Cl)({},n),integrations:(0,ln.Cl)({},o)};return null!==t&&(a.category=t,a.properties=null!==(i=a.properties)&&void 0!==i?i:{},a.properties.category=t),null!==e&&(a.name=e),this.normalize((0,ln.Cl)((0,ln.Cl)({},this.baseEvent()),a))},t.prototype.screen=function(t,e,r,n,o){this.settings.onEventMethodCall({type:"screen",options:n});var i={type:"screen",properties:(0,ln.Cl)({},r),options:(0,ln.Cl)({},n),integrations:(0,ln.Cl)({},o)};return null!==t&&(i.category=t),null!==e&&(i.name=e),this.normalize((0,ln.Cl)((0,ln.Cl)({},this.baseEvent()),i))},t.prototype.identify=function(t,e,r,n){return this.settings.onEventMethodCall({type:"identify",options:r}),this.normalize((0,ln.Cl)((0,ln.Cl)({},this.baseEvent()),{type:"identify",userId:t,traits:null!=e?e:{},options:(0,ln.Cl)({},r),integrations:n}))},t.prototype.group=function(t,e,r,n){return this.settings.onEventMethodCall({type:"group",options:r}),this.normalize((0,ln.Cl)((0,ln.Cl)({},this.baseEvent()),{type:"group",traits:null!=e?e:{},options:(0,ln.Cl)({},r),integrations:(0,ln.Cl)({},n),groupId:t}))},t.prototype.alias=function(t,e,r,n){this.settings.onEventMethodCall({type:"alias",options:r});var o={userId:t,type:"alias",options:(0,ln.Cl)({},r),integrations:(0,ln.Cl)({},n)};return null!==e&&(o.previousId=e),void 0===t?this.normalize((0,ln.Cl)((0,ln.Cl)({},o),this.baseEvent())):this.normalize((0,ln.Cl)((0,ln.Cl)({},this.baseEvent()),o))},t.prototype.baseEvent=function(){return{integrations:{},options:{}}},t.prototype.context=function(t){var e,r=["userId","anonymousId","timestamp","messageId"];delete t.integrations;var n=Object.keys(t),o=null!==(e=t.context)&&void 0!==e?e:{},i={};return n.forEach((function(e){"context"!==e&&(r.includes(e)?(0,Rn.J)(i,e,t[e]):(0,Rn.J)(o,e,t[e]))})),[o,i]},t.prototype.normalize=function(t){var e,r,n,o,i=Object.keys(null!==(e=t.integrations)&&void 0!==e?e:{}).reduce((function(e,r){var n,o;return(0,ln.Cl)((0,ln.Cl)({},e),((n={})[r]=Boolean(null===(o=t.integrations)||void 0===o?void 0:o[r]),n))}),{});t.options=(n=t.options||{},o=function(t,e){return void 0!==e},Object.keys(n).filter((function(t){return o(t,n[t])})).reduce((function(t,e){return t[e]=n[e],t}),{}));var a=(0,ln.Cl)((0,ln.Cl)({},i),null===(r=t.options)||void 0===r?void 0:r.integrations),u=t.options?this.context(t.options):[],c=u[0],s=u[1],l=t.options,f=(0,ln.Tt)(t,["options"]),p=(0,ln.Cl)((0,ln.Cl)((0,ln.Cl)((0,ln.Cl)({timestamp:new Date},f),{context:c,integrations:a}),s),{messageId:l.messageId||this.settings.createMessageId()});return this.settings.onFinishedEvent(p),Xn(p),p},t}(),Vn=function(t){function e(e){var r=t.call(this,{createMessageId:function(){return"ajs-next-".concat(Date.now(),"-").concat((0,Nn.v4)())},onEventMethodCall:function(t){var e=t.options;r.maybeUpdateAnonId(e)},onFinishedEvent:function(t){return r.addIdentity(t),t}})||this;return r.user=e,r}return(0,ln.C6)(e,t),e.prototype.maybeUpdateAnonId=function(t){(null==t?void 0:t.anonymousId)&&this.user.anonymousId(t.anonymousId)},e.prototype.addIdentity=function(t){this.user.id()&&(t.userId=this.user.id()),this.user.anonymousId()&&(t.anonymousId=this.user.anonymousId())},e.prototype.track=function(e,r,n,o,i){var a=t.prototype.track.call(this,e,r,n,o);return Hn(a,i),a},e.prototype.page=function(e,r,n,o,i,a){var u=t.prototype.page.call(this,e,r,n,o,i);return Hn(u,a),u},e.prototype.screen=function(e,r,n,o,i,a){var u=t.prototype.screen.call(this,e,r,n,o,i);return Hn(u,a),u},e.prototype.identify=function(e,r,n,o,i){var a=t.prototype.identify.call(this,e,r,n,o);return Hn(a,i),a},e.prototype.group=function(e,r,n,o,i){var a=t.prototype.group.call(this,e,r,n,o);return Hn(a,i),a},e.prototype.alias=function(e,r,n,o,i){var a=t.prototype.alias.call(this,e,r,n,o);return Hn(a,i),a},e}(qn),Un=function(t){return"addMiddleware"in t&&"destination"===t.type};var Jn="onRemoveFromFuture",Qn=function(t){function e(e,r,n){var o=t.call(this)||this;return o.future=[],o.maxAttempts=e,o.queue=r,o.seen=null!=n?n:{},o}return(0,ln.C6)(e,t),e.prototype.push=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=e.map((function(e){return!(t.updateAttempts(e)>t.maxAttempts||t.includes(e))&&(t.queue.push(e),!0)}));return this.queue=this.queue.sort((function(e,r){return t.getAttempts(e)-t.getAttempts(r)})),n},e.prototype.pushWithBackoff=function(t,e){var r=this;if(void 0===e&&(e=0),0==e&&0===this.getAttempts(t))return this.push(t)[0];var n=this.updateAttempts(t);if(n>this.maxAttempts||this.includes(t))return!1;var o=function(t){var e=Math.random()+1,r=t.minTimeout,n=void 0===r?500:r,o=t.factor,i=void 0===o?2:o,a=t.attempt,u=t.maxTimeout,c=void 0===u?1/0:u;return Math.min(e*n*Math.pow(i,a),c)}({attempt:n-1});return e>0&&o<e&&(o=e),setTimeout((function(){r.queue.push(t),r.future=r.future.filter((function(e){return e.id!==t.id})),r.emit(Jn)}),o),this.future.push(t),!0},e.prototype.getAttempts=function(t){var e;return null!==(e=this.seen[t.id])&&void 0!==e?e:0},e.prototype.updateAttempts=function(t){return this.seen[t.id]=this.getAttempts(t)+1,this.getAttempts(t)},e.prototype.includes=function(t){return this.queue.includes(t)||this.future.includes(t)||Boolean(this.queue.find((function(e){return e.id===t.id})))||Boolean(this.future.find((function(e){return e.id===t.id})))},e.prototype.pop=function(){return this.queue.shift()},Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"todo",{get:function(){return this.queue.length+this.future.length},enumerable:!1,configurable:!0}),e}(Lt),$n={getItem:function(){},setItem:function(){},removeItem:function(){}};try{$n=vn()&&window.localStorage?window.localStorage:$n}catch(t){console.warn("Unable to access localStorage",t)}function to(t){var e=$n.getItem(t);return(e?JSON.parse(e):[]).map((function(t){return new Tn(t.event,t.id)}))}function eo(t){var e=$n.getItem(t);return e?JSON.parse(e):{}}function ro(t){$n.removeItem(t)}function no(t,e,r){void 0===r&&(r=0);var n="persisted-queue:v1:".concat(t,":lock"),o=$n.getItem(n),i=o?JSON.parse(o):null,a=null===i||function(t){return(new Date).getTime()>t}(i);if(a)return $n.setItem(n,JSON.stringify((new Date).getTime()+50)),e(),void $n.removeItem(n);!a&&r<3?setTimeout((function(){no(t,e,r+1)}),50):console.error("Unable to retrieve lock")}var oo=function(t){function e(e,r){var n=t.call(this,e,[])||this,o="persisted-queue:v1:".concat(r,":items"),i="persisted-queue:v1:".concat(r,":seen"),a=[],u={};return no(r,(function(){try{a=to(o),u=eo(i),ro(o),ro(i),n.queue=(0,ln.fX)((0,ln.fX)([],a,!0),n.queue,!0),n.seen=(0,ln.Cl)((0,ln.Cl)({},u),n.seen)}catch(t){console.error(t)}})),window.addEventListener("pagehide",(function(){if(n.todo>0){var t=(0,ln.fX)((0,ln.fX)([],n.queue,!0),n.future,!0);try{no(r,(function(){!function(t,e){var r=to(t),n=(0,ln.fX)((0,ln.fX)([],e,!0),r,!0).reduce((function(t,e){var r;return(0,ln.Cl)((0,ln.Cl)({},t),((r={})[e.id]=e,r))}),{});$n.setItem(t,JSON.stringify(Object.values(n)))}(o,t),function(t,e){var r=eo(t);$n.setItem(t,JSON.stringify((0,ln.Cl)((0,ln.Cl)({},r),e)))}(i,n.seen)}))}catch(t){console.error(t)}}})),n}return(0,ln.C6)(e,t),e}(Qn);function io(t){return io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},io(t)}var ao=function(){var t,e,r=0;return{done:function(){return t},run:function(n){var o,i=n();return"object"===io(o=i)&&null!==o&&"then"in o&&"function"==typeof o.then&&(1==++r&&(t=new Promise((function(t){return e=t}))),i.finally((function(){return 0==--r&&e()}))),i}}};function uo(t,e){t.log("debug","plugin",{plugin:e.name});var r=(new Date).getTime(),n=e[t.event.type];return void 0===n?Promise.resolve(t):function(t){return(0,ln.sH)(this,void 0,void 0,(function(){var e;return(0,ln.YH)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,t()];case 1:return[2,r.sent()];case 2:return e=r.sent(),[2,Promise.reject(e)];case 3:return[2]}}))}))}((function(){return n.apply(e,[t])})).then((function(t){var n=(new Date).getTime()-r;return t.stats.gauge("plugin_time",n,["plugin:".concat(e.name)]),t})).catch((function(r){if(r instanceof mn.d&&"middleware_cancellation"===r.type)throw r;return r instanceof mn.d?(t.log("warn",r.type,{plugin:e.name,error:r}),r):(t.log("error","plugin Error",{plugin:e.name,error:r}),t.stats.increment("plugin_error",1,["plugin:".concat(e.name)]),r)}))}function co(t,e){return uo(t,e).then((function(e){if(e instanceof mn.j)return e;t.log("debug","Context canceled"),t.stats.increment("context_canceled"),t.cancel(e)}))}var so=function(t){function e(e){return t.call(this,"string"==typeof e?new oo(4,e):e)||this}return(0,ln.C6)(e,t),e.prototype.flush=function(){return(0,ln.sH)(this,void 0,void 0,(function(){return(0,ln.YH)(this,(function(e){return gn()?[2,[]]:[2,t.prototype.flush.call(this)]}))}))},e}(function(t){function e(e){var r=t.call(this)||this;return r.criticalTasks=ao(),r.plugins=[],r.failedInitializations=[],r.flushing=!1,r.queue=e,r.queue.on(Jn,(function(){r.scheduleFlush(0)})),r}return(0,ln.C6)(e,t),e.prototype.register=function(t,e,r){return(0,ln.sH)(this,void 0,void 0,(function(){var n,o,i=this;return(0,ln.YH)(this,(function(a){switch(a.label){case 0:return this.plugins.push(e),n=function(r){i.failedInitializations.push(e.name),i.emit("initialization_failure",e),console.warn(e.name,r),t.log("warn","Failed to load destination",{plugin:e.name,error:r}),i.plugins=i.plugins.filter((function(t){return t!==e}))},"destination"!==e.type||"Segment.io"===e.name?[3,1]:(e.load(t,r).catch(n),[3,4]);case 1:return a.trys.push([1,3,,4]),[4,e.load(t,r)];case 2:return a.sent(),[3,4];case 3:return o=a.sent(),n(o),[3,4];case 4:return[2]}}))}))},e.prototype.deregister=function(t,e,r){return(0,ln.sH)(this,void 0,void 0,(function(){var n;return(0,ln.YH)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),e.unload?[4,Promise.resolve(e.unload(t,r))]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.plugins=this.plugins.filter((function(t){return t.name!==e.name})),[3,4];case 3:return n=o.sent(),t.log("warn","Failed to unload destination",{plugin:e.name,error:n}),[3,4];case 4:return[2]}}))}))},e.prototype.dispatch=function(t){return(0,ln.sH)(this,void 0,void 0,(function(){var e;return(0,ln.YH)(this,(function(r){return t.log("debug","Dispatching"),t.stats.increment("message_dispatched"),this.queue.push(t),e=this.subscribeToDelivery(t),this.scheduleFlush(0),[2,e]}))}))},e.prototype.subscribeToDelivery=function(t){return(0,ln.sH)(this,void 0,void 0,(function(){var e=this;return(0,ln.YH)(this,(function(r){return[2,new Promise((function(r){e.on("flush",(function n(o,i){o.isSame(t)&&(e.off("flush",n),r(o))}))}))]}))}))},e.prototype.dispatchSingle=function(t){return(0,ln.sH)(this,void 0,void 0,(function(){var e=this;return(0,ln.YH)(this,(function(r){return t.log("debug","Dispatching"),t.stats.increment("message_dispatched"),this.queue.updateAttempts(t),t.attempts=1,[2,this.deliver(t).catch((function(r){return e.enqueuRetry(r,t)?e.subscribeToDelivery(t):(t.setFailedDelivery({reason:r}),t)}))]}))}))},e.prototype.isEmpty=function(){return 0===this.queue.length},e.prototype.scheduleFlush=function(t){var e=this;void 0===t&&(t=500),this.flushing||(this.flushing=!0,setTimeout((function(){e.flush().then((function(){setTimeout((function(){e.flushing=!1,e.queue.length&&e.scheduleFlush(0)}),0)}))}),t))},e.prototype.deliver=function(t){return(0,ln.sH)(this,void 0,void 0,(function(){var e,r,n,o;return(0,ln.YH)(this,(function(i){switch(i.label){case 0:return[4,this.criticalTasks.done()];case 1:i.sent(),e=Date.now(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.flushOne(t)];case 3:return t=i.sent(),r=Date.now()-e,this.emit("delivery_success",t),t.stats.gauge("delivered",r),t.log("debug","Delivered",t.event),[2,t];case 4:throw n=i.sent(),o=n,t.log("error","Failed to deliver",o),this.emit("delivery_failure",t,o),t.stats.increment("delivery_failed"),n;case 5:return[2]}}))}))},e.prototype.enqueuRetry=function(t,e){return!(t instanceof mn.d&&!t.retry)&&this.queue.pushWithBackoff(e)},e.prototype.flush=function(){return(0,ln.sH)(this,void 0,void 0,(function(){var t,e;return(0,ln.YH)(this,(function(r){switch(r.label){case 0:if(0===this.queue.length)return[2,[]];if(!(t=this.queue.pop()))return[2,[]];t.attempts=this.queue.getAttempts(t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.deliver(t)];case 2:return t=r.sent(),this.emit("flush",t,!0),[3,4];case 3:return e=r.sent(),this.enqueuRetry(e,t)||(t.setFailedDelivery({reason:e}),this.emit("flush",t,!1)),[2,[]];case 4:return[2,[t]]}}))}))},e.prototype.isReady=function(){return!0},e.prototype.availableExtensions=function(t){var e,r,n=this.plugins.filter((function(e){var r,n,o;if("destination"!==e.type&&"Segment.io"!==e.name)return!0;var i=void 0;return null===(r=e.alternativeNames)||void 0===r||r.forEach((function(e){void 0!==t[e]&&(i=t[e])})),null!==(o=null!==(n=t[e.name])&&void 0!==n?n:i)&&void 0!==o?o:!1!==("Segment.io"===e.name||t.All)})),o=(e="type",r={},n.forEach((function(t){var n,o=void 0;if("string"==typeof e){var i=t[e];o="string"!=typeof i?JSON.stringify(i):i}else e instanceof Function&&(o=e(t));void 0!==o&&(r[o]=(0,ln.fX)((0,ln.fX)([],null!==(n=r[o])&&void 0!==n?n:[],!0),[t],!1))})),r),i=o.before,a=void 0===i?[]:i,u=o.enrichment,c=void 0===u?[]:u,s=o.destination,l=void 0===s?[]:s,f=o.after;return{before:a,enrichment:c,destinations:l,after:void 0===f?[]:f}},e.prototype.flushOne=function(t){var e,r;return(0,ln.sH)(this,void 0,void 0,(function(){var n,o,i,a,u,c,s,l,f,p,h,y,d,v;return(0,ln.YH)(this,(function(g){switch(g.label){case 0:if(!this.isReady())throw new Error("Not ready");t.attempts>1&&this.emit("delivery_retry",t),n=this.availableExtensions(null!==(e=t.event.integrations)&&void 0!==e?e:{}),o=n.before,i=n.enrichment,a=0,u=o,g.label=1;case 1:return a<u.length?(c=u[a],[4,co(t,c)]):[3,4];case 2:(p=g.sent())instanceof mn.j&&(t=p),this.emit("message_enriched",t,c),g.label=3;case 3:return a++,[3,1];case 4:s=0,l=i,g.label=5;case 5:return s<l.length?(f=l[s],[4,uo(t,f)]):[3,8];case 6:(p=g.sent())instanceof mn.j&&(t=p),this.emit("message_enriched",t,f),g.label=7;case 7:return s++,[3,5];case 8:return h=this.availableExtensions(null!==(r=t.event.integrations)&&void 0!==r?r:{}),y=h.destinations,d=h.after,[4,new Promise((function(e,r){setTimeout((function(){var n=y.map((function(e){return uo(t,e)}));Promise.all(n).then(e).catch(r)}),0)}))];case 9:return g.sent(),t.stats.increment("message_delivered"),this.emit("message_delivered",t),v=d.map((function(e){return uo(t,e)})),[4,Promise.all(v)];case 10:return g.sent(),[2,t]}}))}))},e}(Lt));function lo(t){for(var e=t.constructor.prototype,r=0,n=Object.getOwnPropertyNames(e);r<n.length;r++){var o=n[r];if("constructor"!==o){var i=Object.getOwnPropertyDescriptor(t.constructor.prototype,o);i&&"function"==typeof i.value&&(t[o]=t[o].bind(t))}}return t}var fo={Cookie:"cookie",LocalStorage:"localStorage",Memory:"memory"},po=function(t,e,r,n){console.warn("".concat(t.constructor.name,": Can't ").concat(e,' key "').concat(r,'" | Err: ').concat(n))},ho=function(){function t(t){this.stores=t}return t.prototype.get=function(t){for(var e=null,r=0,n=this.stores;r<n.length;r++){var o=n[r];try{if(null!=(e=o.get(t)))return e}catch(e){po(o,"get",t,e)}}return null},t.prototype.set=function(t,e){this.stores.forEach((function(r){try{r.set(t,e)}catch(e){po(r,"set",t,e)}}))},t.prototype.clear=function(t){this.stores.forEach((function(e){try{e.remove(t)}catch(r){po(e,"remove",t,r)}}))},t.prototype.getAndSync=function(t){var e=this.get(t),r="number"==typeof e?e.toString():e;return this.set(t,r),r},t}(),yo=function(){function t(){this.cache={}}return t.prototype.get=function(t){var e;return null!==(e=this.cache[t])&&void 0!==e?e:null},t.prototype.set=function(t,e){this.cache[t]=e},t.prototype.remove=function(t){delete this.cache[t]},t}();function vo(t){return vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vo(t)}function go(t){return t&&t.stores&&Array.isArray(t.stores)&&t.stores.every((function(t){return Object.values(fo).includes(t)}))}function mo(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}var bo=function t(e,r){function n(t,n,o){if("undefined"!=typeof document){"number"==typeof(o=mo({},r,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var a in o)o[a]&&(i+="; "+a,!0!==o[a]&&(i+="="+o[a].split(";")[0]));return document.cookie=t+"="+e.write(n,t)+i}}return Object.create({set:n,get:function(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var r=document.cookie?document.cookie.split("; "):[],n={},o=0;o<r.length;o++){var i=r[o].split("="),a=i.slice(1).join("=");try{var u=decodeURIComponent(i[0]);if(n[u]=e.read(a,u),t===u)break}catch(t){}}return t?n[t]:n}},remove:function(t,e){n(t,"",mo({},e,{expires:-1}))},withAttributes:function(e){return t(this.converter,mo({},this.attributes,e))},withConverter:function(e){return t(mo({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(e)}})}({read:function(t){return'"'===t[0]&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),wo=bo;function So(t){var e=function(t){try{return new URL(t)}catch(t){return}}(t);if(e)for(var r=function(t){var e=t.hostname.split("."),r=e[e.length-1],n=[];if(4===e.length&&parseInt(r,10)>0)return n;if(e.length<=1)return n;for(var o=e.length-2;o>=0;--o)n.push(e.slice(o).join("."));return n}(e),n=0;n<r.length;++n){var o="__tld__",i=r[n],a={domain:"."+i};try{if(wo.set(o,"1",a),wo.get(o))return wo.remove(o,a),i}catch(t){return}}}var xo=function(){function t(e){void 0===e&&(e=t.defaults),this.options=(0,ln.Cl)((0,ln.Cl)({},t.defaults),e)}return Object.defineProperty(t,"defaults",{get:function(){return{maxage:365,domain:So(window.location.href),path:"/",sameSite:"Lax"}},enumerable:!1,configurable:!0}),t.prototype.opts=function(){return{sameSite:this.options.sameSite,expires:this.options.maxage,domain:this.options.domain,path:this.options.path,secure:this.options.secure}},t.prototype.get=function(t){var e;try{var r=wo.get(t);if(null==r)return null;try{return null!==(e=JSON.parse(r))&&void 0!==e?e:null}catch(t){return null!=r?r:null}}catch(t){return null}},t.prototype.set=function(t,e){"string"==typeof e?wo.set(t,e,this.opts()):null===e?wo.remove(t,this.opts()):wo.set(t,JSON.stringify(e),this.opts())},t.prototype.remove=function(t){return wo.remove(t,this.opts())},t}(),Oo=function(){function t(){}return t.prototype.localStorageWarning=function(t,e){console.warn("Unable to access ".concat(t,", localStorage may be ").concat(e))},t.prototype.get=function(t){var e;try{var r=localStorage.getItem(t);if(null===r)return null;try{return null!==(e=JSON.parse(r))&&void 0!==e?e:null}catch(t){return null!=r?r:null}}catch(e){return this.localStorageWarning(t,"unavailable"),null}},t.prototype.set=function(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(e){this.localStorageWarning(t,"full")}},t.prototype.remove=function(t){try{return localStorage.removeItem(t)}catch(e){this.localStorageWarning(t,"unavailable")}},t}();function jo(t){return t.map((function(t){var e,r;switch(!function(t){return"object"===vo(t)&&void 0!==t.name}(t)?e=t:(e=t.name,r=t.settings),e){case fo.Cookie:return new xo(r);case fo.LocalStorage:return new Oo;case fo.Memory:return new yo;default:throw new Error("Unknown Store Type: ".concat(t))}}))}function Eo(t,e){return t.map((function(t){return e&&t===fo.Cookie?{name:t,settings:e}:t}))}function ko(t){return ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ko(t)}var Lo={persist:!0,cookie:{key:"ajs_user_id",oldKey:"ajs_user"},localStorage:{key:"ajs_user_traits"}},_o=function(){function t(t,e){void 0===t&&(t=Lo);var r,n,o,i,a=this;this.options={},this.id=function(t){if(a.options.disable)return null;var e=a.identityStore.getAndSync(a.idKey);void 0!==t&&(a.identityStore.set(a.idKey,t),t!==e&&null!==e&&null!==t&&a.anonymousId(null));var r=a.identityStore.getAndSync(a.idKey);if(r)return r;var n=a.legacyUserStore.get(Lo.cookie.oldKey);return n?"object"===ko(n)?n.id:n:null},this.anonymousId=function(t){var e,r;if(a.options.disable)return null;if(void 0===t){var n=null!==(e=a.identityStore.getAndSync(a.anonKey))&&void 0!==e?e:null===(r=a.legacySIO())||void 0===r?void 0:r[0];if(n)return n}return null===t?(a.identityStore.set(a.anonKey,null),a.identityStore.getAndSync(a.anonKey)):(a.identityStore.set(a.anonKey,null!=t?t:(0,Nn.v4)()),a.identityStore.getAndSync(a.anonKey))},this.traits=function(t){var e;if(!a.options.disable)return null===t&&(t={}),t&&a.traitsStore.set(a.traitsKey,null!=t?t:{}),null!==(e=a.traitsStore.get(a.traitsKey))&&void 0!==e?e:{}},this.options=(0,ln.Cl)((0,ln.Cl)({},Lo),t),this.cookieOptions=e,this.idKey=null!==(n=null===(r=t.cookie)||void 0===r?void 0:r.key)&&void 0!==n?n:Lo.cookie.key,this.traitsKey=null!==(i=null===(o=t.localStorage)||void 0===o?void 0:o.key)&&void 0!==i?i:Lo.localStorage.key,this.anonKey="ajs_anonymous_id",this.identityStore=this.createStorage(this.options,e),this.legacyUserStore=this.createStorage(this.options,e,(function(t){return t===fo.Cookie})),this.traitsStore=this.createStorage(this.options,e,(function(t){return t!==fo.Cookie}));var u=this.legacyUserStore.get(Lo.cookie.oldKey);u&&"object"===ko(u)&&(u.id&&this.id(u.id),u.traits&&this.traits(u.traits)),lo(this)}return t.prototype.legacySIO=function(){var t=this.legacyUserStore.get("_sio");if(!t)return null;var e=t.split("----");return[e[0],e[1]]},t.prototype.identify=function(t,e){if(!this.options.disable){e=null!=e?e:{};var r=this.id();null!==r&&r!==t||(e=(0,ln.Cl)((0,ln.Cl)({},this.traits()),e)),t&&this.id(t),this.traits(e)}},t.prototype.logout=function(){this.anonymousId(null),this.id(null),this.traits({})},t.prototype.reset=function(){this.logout(),this.identityStore.clear(this.idKey),this.identityStore.clear(this.anonKey),this.traitsStore.clear(this.traitsKey)},t.prototype.load=function(){return new t(this.options,this.cookieOptions)},t.prototype.save=function(){return!0},t.prototype.createStorage=function(t,e,r){var n=[fo.LocalStorage,fo.Cookie,fo.Memory];return t.disable?new ho([]):t.persist?(void 0!==t.storage&&null!==t.storage&&go(t.storage)&&(n=t.storage.stores),t.localStorageFallbackDisabled&&(n=n.filter((function(t){return t!==fo.LocalStorage}))),r&&(n=n.filter(r)),new ho(jo(Eo(n,e)))):new ho([new yo])},t.defaults=Lo,t}(),Po={persist:!0,cookie:{key:"ajs_group_id"},localStorage:{key:"ajs_group_properties"}},Io=function(t){function e(e,r){void 0===e&&(e=Po);var n=t.call(this,(0,ln.Cl)((0,ln.Cl)({},Po),e),r)||this;return n.anonymousId=function(t){},lo(n),n}return(0,ln.C6)(e,t),e}(_o),To="analytics";function Co(t){return Co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Co(t)}var Ao=function(t,e,r){r.getAndRemove(t).forEach((function(t){Do(e,t).catch(console.error)}))},No=(Ao.bind(void 0,"on"),Ao.bind(void 0,"setAnonymousId"),function(t){if(Fo(t)){var e=t.pop();return Mn(e)}}),Fo=function(t){return function(t){if(!(0,fn.Qd)(t))return!1;if("bpc"!==t.__t)return!1;for(var e in t)if(!Gn.includes(e))return!1;return!0}(t[t.length-1])},Go=function(t,e,r,n){void 0===r&&(r=function(){}),void 0===n&&(n=console.error),this.method=t,this.resolve=r,this.reject=n,this.called=!1,this.args=e},Mo=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._callMap={},this.add.apply(this,t)}return Object.defineProperty(t.prototype,"calls",{get:function(){return this._pushSnippetWindowBuffer(),this._callMap},set:function(t){this._callMap=t},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e;return null!==(e=this.calls[t])&&void 0!==e?e:[]},t.prototype.getAndRemove=function(t){var e=this.get(t);return this.calls[t]=[],e},t.prototype.add=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];e.forEach((function(e){["track","screen","alias","group","page","identify"].includes(e.method)&&!Fo(e.args)&&(e.args=(0,ln.fX)((0,ln.fX)([],e.args,!0),[Dn()],!1)),t.calls[e.method]?t.calls[e.method].push(e):t.calls[e.method]=[e]}))},t.prototype.clear=function(){this._pushSnippetWindowBuffer(),this.calls={}},t.prototype.toArray=function(){var t;return(t=[]).concat.apply(t,Object.values(this.calls))},t.prototype._pushSnippetWindowBuffer=function(){if("npm"!==En()){var t=window[To];if(Array.isArray(t)){var e=t.splice(0,t.length).map((function(t){var e=t[0],r=t.slice(1);return new Go(e,r)}));this.add.apply(this,e)}}},t}();function Do(t,e){return(0,ln.sH)(this,void 0,void 0,(function(){var r,n;return(0,ln.YH)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),e.called?[2,void 0]:(e.called=!0,r=t[e.method].apply(t,e.args),"object"===Co(i=r)&&null!==i&&"then"in i&&"function"==typeof i.then?[4,r]:[3,2]);case 1:o.sent(),o.label=2;case 2:return e.resolve(r),[3,4];case 3:return n=o.sent(),e.reject(n),[3,4];case 4:return[2]}var i}))}))}!function(){function t(t){var e=this;this.trackSubmit=this._createMethod("trackSubmit"),this.trackClick=this._createMethod("trackClick"),this.trackLink=this._createMethod("trackLink"),this.pageView=this._createMethod("pageview"),this.identify=this._createMethod("identify"),this.reset=this._createMethod("reset"),this.group=this._createMethod("group"),this.track=this._createMethod("track"),this.ready=this._createMethod("ready"),this.alias=this._createMethod("alias"),this.debug=this._createChainableMethod("debug"),this.page=this._createMethod("page"),this.once=this._createChainableMethod("once"),this.off=this._createChainableMethod("off"),this.on=this._createChainableMethod("on"),this.addSourceMiddleware=this._createMethod("addSourceMiddleware"),this.setAnonymousId=this._createMethod("setAnonymousId"),this.addDestinationMiddleware=this._createMethod("addDestinationMiddleware"),this.screen=this._createMethod("screen"),this.register=this._createMethod("register"),this.deregister=this._createMethod("deregister"),this.user=this._createMethod("user"),this.VERSION=On,this._preInitBuffer=new Mo,this._promise=t(this._preInitBuffer),this._promise.then((function(t){var r=t[0],n=t[1];e.instance=r,e.ctx=n})).catch((function(){}))}t.prototype.then=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return(t=this._promise).then.apply(t,e)},t.prototype.catch=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return(t=this._promise).catch.apply(t,e)},t.prototype.finally=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return(t=this._promise).finally.apply(t,e)},t.prototype._createMethod=function(t){var e=this;return function(){for(var r,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];if(e.instance){var i=(r=e.instance)[t].apply(r,n);return Promise.resolve(i)}return new Promise((function(r,o){e._preInitBuffer.add(new Go(t,n,r,o))}))}},t.prototype._createChainableMethod=function(t){var e=this;return function(){for(var r,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return e.instance?((r=e.instance)[t].apply(r,n),e):(e._preInitBuffer.add(new Go(t,n)),e)}}}();var Ho=o(531),Ro=function(t){function e(e,r){var n=t.call(this,e)||this;return n.retryTimeout=r,n.name="RateLimitError",n}return(0,ln.C6)(e,t),e}(Error),Bo=function(t){return(0,ln.Cl)({"Content-Type":"text/plain"},"function"==typeof t?t():t)};function Yo(t){return(encodeURI(JSON.stringify(t)).split(/%..|./).length-1)/1024}function Ko(t,e){var r,n,o,i,a,u=[],c=!1,s=null!==(r=null==e?void 0:e.size)&&void 0!==r?r:10,l=null!==(n=null==e?void 0:e.timeout)&&void 0!==n?n:5e3,f=0;function p(r){var n;if(0!==r.length){var o=null===(n=r[0])||void 0===n?void 0:n.writeKey,i=r.map((function(t){var e=t;e.sentAt;return(0,ln.Tt)(e,["sentAt"])}));return xn("https://".concat(t,"/b"),{credentials:null==e?void 0:e.credentials,keepalive:(null==e?void 0:e.keepalive)||c,headers:Bo(null==e?void 0:e.headers),method:"post",body:JSON.stringify({writeKey:o,batch:i,sentAt:(new Date).toISOString()}),priority:null==e?void 0:e.priority}).then((function(t){var e;if(t.status>=500)throw new Error("Bad response from server: ".concat(t.status));if(429===t.status){var r=null===(e=t.headers)||void 0===e?void 0:e.get("x-ratelimit-reset"),n="string"==typeof r?1e3*parseInt(r):l;throw new Ro("Rate limit exceeded: ".concat(t.status),n)}}))}}function h(t){var r;return void 0===t&&(t=1),(0,ln.sH)(this,void 0,void 0,(function(){var n;return(0,ln.YH)(this,(function(o){return u.length?(n=u,u=[],[2,null===(r=p(n))||void 0===r?void 0:r.catch((function(r){var o;Tn.system().log("error","Error sending batch",r),t<=(null!==(o=null==e?void 0:e.maxRetries)&&void 0!==o?o:10)&&("RateLimitError"===r.name&&(f=r.retryTimeout),u.push.apply(u,n),u.map((function(e){if("_metadata"in e){var r=e;r._metadata=(0,ln.Cl)((0,ln.Cl)({},r._metadata),{retryCount:t})}})),y(t+1))}))]):[2]}))}))}function y(t){void 0===t&&(t=1),o||(o=setTimeout((function(){o=void 0,h(t).catch(console.error)}),f||l),f=0)}return i=function(t){if((c=t)&&u.length){var e=function(t){var e=[],r=0;return t.forEach((function(t){Yo(e[r])>=64&&r++,e[r]?e[r].push(t):e[r]=[t]})),e}(u).map(p);Promise.all(e).catch(console.error)}},a=!1,window.addEventListener("pagehide",(function(){a||i(a=!0)})),document.addEventListener("visibilitychange",(function(){if("hidden"==document.visibilityState){if(a)return;a=!0}else a=!1;i(a)})),{dispatch:function(t,r){return(0,ln.sH)(this,void 0,void 0,(function(){var t;return(0,ln.YH)(this,(function(n){return u.push(r),t=u.length>=s||function(t){return Yo(t)>=450}(u)||(null==e?void 0:e.keepalive)&&function(t){return Yo(t)>=54}(u),[2,t||c?h():y()]}))}))}}}function zo(t,e,r,n,o){var i,a=t.user();delete e.options,e.writeKey=null==r?void 0:r.apiKey,e.userId=e.userId||a.id(),e.anonymousId=e.anonymousId||a.anonymousId(),e.sentAt=new Date;var u=t.queue.failedInitializations||[];u.length>0&&(e._metadata={failedInitializations:u}),null!=o&&(o.attempts>1&&(e._metadata=(0,ln.Cl)((0,ln.Cl)({},e._metadata),{retryCount:o.attempts})),o.attempts++);var c=[],s=[];for(var l in n){var f=n[l];"Segment.io"===l&&c.push(l),"bundled"===f.bundlingStatus&&c.push(l),"unbundled"===f.bundlingStatus&&s.push(l)}for(var p=0,h=(null==r?void 0:r.unbundledIntegrations)||[];p<h.length;p++){var y=h[p];s.includes(y)||s.push(y)}var d=null!==(i=null==r?void 0:r.maybeBundledConfigIds)&&void 0!==i?i:{},v=[];return c.sort().forEach((function(t){var e;(null!==(e=d[t])&&void 0!==e?e:[]).forEach((function(t){v.push(t)}))})),!1!==(null==r?void 0:r.addBundledMetadata)&&(e._metadata=(0,ln.Cl)((0,ln.Cl)({},e._metadata),{bundled:c.sort(),unbundled:s.sort(),bundledIds:v})),e}function Zo(t,e){return(0,ln.sH)(this,void 0,void 0,(function(){var r,n=this;return(0,ln.YH)(this,(function(o){switch(o.label){case 0:return r=[],gn()?[2,e]:[4,(i=function(){return e.length>0&&!gn()},a=function(){return(0,ln.sH)(n,void 0,void 0,(function(){var n;return(0,ln.YH)(this,(function(o){switch(o.label){case 0:return(n=e.pop())?[4,uo(n,t)]:[2];case 1:return o.sent()instanceof Tn||r.push(n),[2]}}))}))},(0,ln.sH)(void 0,void 0,void 0,(function(){var t;return(0,ln.YH)(this,(function(e){return t=function(e){return(0,ln.sH)(void 0,void 0,void 0,(function(){var r;return(0,ln.YH)(this,(function(n){switch(n.label){case 0:return i(e)?(r=t,[4,a()]):[3,2];case 1:return[2,r.apply(void 0,[n.sent()])];case 2:return[2]}}))}))},[2,t(void 0)]}))})))];case 1:return o.sent(),r.map((function(t){return e.pushWithBackoff(t)})),[2,e]}var i,a}))}))}function Xo(t,e,r,n){var o=this;t||setTimeout((function(){return(0,ln.sH)(o,void 0,void 0,(function(){var t,o;return(0,ln.YH)(this,(function(i){switch(i.label){case 0:return t=!0,[4,Zo(r,e)];case 1:return o=i.sent(),t=!1,e.todo>0&&n(t,o,r,n),[2]}}))}))}),5e3*Math.random())}var Wo=function(t){return"Segment.io"===t.name};function qo(t,e,r){var n,o,i;window.addEventListener("pagehide",(function(){c.push.apply(c,Array.from(s)),s.clear()}));var a,u=null!==(n=null==e?void 0:e.apiKey)&&void 0!==n?n:"",c=t.options.disableClientPersistence?new Qn(t.queue.queue.maxAttempts,[]):new oo(t.queue.queue.maxAttempts,"".concat(u,":dest-Segment.io")),s=new Set,l=!1,f=null!==(o=null==e?void 0:e.apiHost)&&void 0!==o?o:kn,p=null!==(i=null==e?void 0:e.protocol)&&void 0!==i?i:"https",h="".concat(p,"://").concat(f),y=null==e?void 0:e.deliveryStrategy,d=y&&"strategy"in y&&"batching"===y.strategy?Ko(f,y.config):(a=null==y?void 0:y.config,{dispatch:function(t,e){return xn(t,{credentials:null==a?void 0:a.credentials,keepalive:null==a?void 0:a.keepalive,headers:Bo(null==a?void 0:a.headers),method:"post",body:JSON.stringify(e),priority:null==a?void 0:a.priority}).then((function(t){var e;if(t.status>=500)throw new Error("Bad response from server: ".concat(t.status));if(429===t.status){var r=null===(e=t.headers)||void 0===e?void 0:e.get("x-ratelimit-reset"),n=r?1e3*parseInt(r):5e3;throw new Ro("Rate limit exceeded: ".concat(t.status),n)}}))}});function v(n){return(0,ln.sH)(this,void 0,void 0,(function(){var o,i;return(0,ln.YH)(this,(function(a){return gn()?(c.push(n),Xo(l,c,g,Xo),[2,n]):(s.add(n),o=n.event.type.charAt(0),i=(0,Ho.W)(n.event).json(),"track"===n.event.type&&delete i.traits,"alias"===n.event.type&&(i=function(t,e){var r,n,o,i,a=t.user();return e.previousId=null!==(o=null!==(n=null!==(r=e.previousId)&&void 0!==r?r:e.from)&&void 0!==n?n:a.id())&&void 0!==o?o:a.anonymousId(),e.userId=null!==(i=e.userId)&&void 0!==i?i:e.to,delete e.from,delete e.to,e}(t,i)),[2,d.dispatch("".concat(h,"/").concat(o),zo(t,i,e,r,n)).then((function(){return n})).catch((function(t){if(n.log("error","Error sending event",t),"RateLimitError"===t.name){var e=t.retryTimeout;c.pushWithBackoff(n,e)}else c.pushWithBackoff(n);return Xo(l,c,g,Xo),n})).finally((function(){s.delete(n)}))])}))}))}var g={metadata:{writeKey:u,apiHost:f,protocol:p},name:"Segment.io",type:"destination",version:"0.1.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:v,identify:v,page:v,alias:v,group:v,screen:v};return c.todo&&Xo(l,c,g,Xo),g}var Vo="This is being deprecated and will be not be available in future releases of Analytics JS",Uo=Sn(),Jo=null==Uo?void 0:Uo.analytics;var Qo=function(){function t(t,e){var r;this.timeout=300,this._getSegmentPluginMetadata=function(){var t;return null===(t=e.plugins.find(Wo))||void 0===t?void 0:t.metadata},this.writeKey=t.writeKey;this.cdnSettings=null!==(r=t.cdnSettings)&&void 0!==r?r:{integrations:{"Segment.io":{apiKey:""}}},this.cdnURL=t.cdnURL}return Object.defineProperty(t.prototype,"apiHost",{get:function(){var t,e;return null===(e=null===(t=this._getSegmentPluginMetadata)||void 0===t?void 0:t.call(this))||void 0===e?void 0:e.apiHost},enumerable:!1,configurable:!0}),t}();function $o(){console.warn(Vo)}var ti=function(t){function e(e,r,n,o,i){var a,u,c=this;(c=t.call(this)||this)._debug=!1,c.initialized=!1,c.user=function(){return c._user},c.init=c.initialize.bind(c),c.log=$o,c.addIntegrationMiddleware=$o,c.listeners=$o,c.addEventListener=$o,c.removeAllListeners=$o,c.removeListener=$o,c.removeEventListener=$o,c.hasListeners=$o,c.add=$o,c.addIntegration=$o;var s=null==r?void 0:r.cookie,l=null!==(a=null==r?void 0:r.disableClientPersistence)&&void 0!==a&&a;c.queue=null!=n?n:function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=!1);var n=e?10:1,o=r?new Qn(n,[]):new oo(n,t);return new so(o)}("".concat(e.writeKey,":event-queue"),null==r?void 0:r.retryQueue,l),c.settings=new Qo(e,c.queue);var f=null==r?void 0:r.storage;return c._universalStorage=c.createStore(l,f,s),c._user=null!=o?o:new _o((0,ln.Cl)({persist:!l,storage:null==r?void 0:r.storage},null==r?void 0:r.user),s).load(),c._group=null!=i?i:new Io((0,ln.Cl)({persist:!l,storage:null==r?void 0:r.storage},null==r?void 0:r.group),s).load(),c.eventFactory=new Vn(c._user),c.integrations=null!==(u=null==r?void 0:r.integrations)&&void 0!==u?u:{},c.options=null!=r?r:{},lo(c),c}return(0,ln.C6)(e,t),e.prototype.createStore=function(t,e,r){return t?new ho([new yo]):e&&go(e)?new ho(jo(Eo(e.stores,r))):new ho(jo([fo.LocalStorage,{name:fo.Cookie,settings:r},fo.Memory]))},Object.defineProperty(e.prototype,"storage",{get:function(){return this._universalStorage},enumerable:!1,configurable:!0}),e.prototype.track=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r,n,o,i,a,u,c=this;return(0,ln.YH)(this,(function(s){return e=No(t),r=pn.apply(void 0,t),n=r[0],o=r[1],i=r[2],a=r[3],u=this.eventFactory.track(n,o,i,this.integrations,e),[2,this._dispatch(u,a).then((function(t){return c.emit("track",n,t.event.properties,t.event.options),t}))]}))}))},e.prototype.page=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r,n,o,i,a,u,c,s=this;return(0,ln.YH)(this,(function(l){return e=No(t),r=hn.apply(void 0,t),n=r[0],o=r[1],i=r[2],a=r[3],u=r[4],c=this.eventFactory.page(n,o,i,a,this.integrations,e),[2,this._dispatch(c,u).then((function(t){return s.emit("page",n,o,t.event.properties,t.event.options),t}))]}))}))},e.prototype.identify=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r,n,o,i,a,u,c=this;return(0,ln.YH)(this,(function(s){return e=No(t),r=yn(this._user).apply(void 0,t),n=r[0],o=r[1],i=r[2],a=r[3],this._user.identify(n,o),u=this.eventFactory.identify(this._user.id(),this._user.traits(),i,this.integrations,e),[2,this._dispatch(u,a).then((function(t){return c.emit("identify",t.event.userId,t.event.traits,t.event.options),t}))]}))}))},e.prototype.group=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=No(e);if(0===e.length)return this._group;var o=yn(this._group).apply(void 0,e),i=o[0],a=o[1],u=o[2],c=o[3];this._group.identify(i,a);var s=this._group.id(),l=this._group.traits(),f=this.eventFactory.group(s,l,u,this.integrations,n);return this._dispatch(f,c).then((function(e){return t.emit("group",e.event.groupId,e.event.traits,e.event.options),e}))},e.prototype.alias=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r,n,o,i,a,u,c=this;return(0,ln.YH)(this,(function(s){return e=No(t),r=dn.apply(void 0,t),n=r[0],o=r[1],i=r[2],a=r[3],u=this.eventFactory.alias(n,o,i,this.integrations,e),[2,this._dispatch(u,a).then((function(t){return c.emit("alias",n,o,t.event.options),t}))]}))}))},e.prototype.screen=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r,n,o,i,a,u,c,s=this;return(0,ln.YH)(this,(function(l){return e=No(t),r=hn.apply(void 0,t),n=r[0],o=r[1],i=r[2],a=r[3],u=r[4],c=this.eventFactory.screen(n,o,i,a,this.integrations,e),[2,this._dispatch(c,u).then((function(t){return s.emit("screen",n,o,t.event.properties,t.event.options),t}))]}))}))},e.prototype.trackClick=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r;return(0,ln.YH)(this,(function(n){switch(n.label){case 0:return[4,o.e(248).then(o.bind(o,260))];case 1:return e=n.sent(),[2,(r=e.link).call.apply(r,(0,ln.fX)([this],t,!1))]}}))}))},e.prototype.trackLink=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r;return(0,ln.YH)(this,(function(n){switch(n.label){case 0:return[4,o.e(248).then(o.bind(o,260))];case 1:return e=n.sent(),[2,(r=e.link).call.apply(r,(0,ln.fX)([this],t,!1))]}}))}))},e.prototype.trackSubmit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r;return(0,ln.YH)(this,(function(n){switch(n.label){case 0:return[4,o.e(248).then(o.bind(o,260))];case 1:return e=n.sent(),[2,(r=e.form).call.apply(r,(0,ln.fX)([this],t,!1))]}}))}))},e.prototype.trackForm=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r;return(0,ln.YH)(this,(function(n){switch(n.label){case 0:return[4,o.e(248).then(o.bind(o,260))];case 1:return e=n.sent(),[2,(r=e.form).call.apply(r,(0,ln.fX)([this],t,!1))]}}))}))},e.prototype.register=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r,n=this;return(0,ln.YH)(this,(function(o){switch(o.label){case 0:return e=Tn.system(),r=t.map((function(t){return n.queue.register(e,t,n)})),[4,Promise.all(r)];case 1:return o.sent(),[2,e]}}))}))},e.prototype.deregister=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(0,ln.sH)(this,void 0,void 0,(function(){var e,r,n=this;return(0,ln.YH)(this,(function(o){switch(o.label){case 0:return e=Tn.system(),r=t.map((function(t){var r=n.queue.plugins.find((function(e){return e.name===t}));if(r)return n.queue.deregister(e,r,n);e.log("warn","plugin ".concat(t," not found"))})),[4,Promise.all(r)];case 1:return o.sent(),[2,e]}}))}))},e.prototype.debug=function(t){return!1===t&&localStorage.getItem("debug")&&localStorage.removeItem("debug"),this._debug=t,this},e.prototype.reset=function(){this._user.reset(),this._group.reset(),this.emit("reset")},e.prototype.timeout=function(t){this.settings.timeout=t},e.prototype._dispatch=function(t,e){return(0,ln.sH)(this,void 0,void 0,(function(){var r;return(0,ln.YH)(this,(function(n){return(r=new Tn(t)).stats.increment("analytics_js.invoke",1,[t.type]),gn()&&!this.options.retryQueue?[2,r]:[2,An(r,this.queue,this,{callback:e,debug:this._debug,timeout:this.settings.timeout})]}))}))},e.prototype.addSourceMiddleware=function(t){return(0,ln.sH)(this,void 0,void 0,(function(){var e=this;return(0,ln.YH)(this,(function(r){switch(r.label){case 0:return[4,this.queue.criticalTasks.run((function(){return(0,ln.sH)(e,void 0,void 0,(function(){var e,r,n;return(0,ln.YH)(this,(function(i){switch(i.label){case 0:return[4,o.e(751).then(o.bind(o,127))];case 1:return e=i.sent().sourceMiddlewarePlugin,r={},this.queue.plugins.forEach((function(t){if("destination"===t.type)return r[t.name]=!0})),n=e(t,r),[4,this.register(n)];case 2:return i.sent(),[2]}}))}))}))];case 1:return r.sent(),[2,this]}}))}))},e.prototype.addDestinationMiddleware=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return this.queue.plugins.filter(Un).forEach((function(r){"*"!==t&&r.name.toLowerCase()!==t.toLowerCase()||r.addMiddleware.apply(r,e)})),Promise.resolve(this)},e.prototype.setAnonymousId=function(t){return this._user.anonymousId(t)},e.prototype.queryString=function(t){return(0,ln.sH)(this,void 0,void 0,(function(){return(0,ln.YH)(this,(function(e){switch(e.label){case 0:return!1===this.options.useQueryString?[2,[]]:[4,o.e(538).then(o.bind(o,220))];case 1:return[2,(0,e.sent().queryString)(this,t)]}}))}))},e.prototype.use=function(t){return t(this),this},e.prototype.ready=function(t){return void 0===t&&(t=function(t){return t}),(0,ln.sH)(this,void 0,void 0,(function(){return(0,ln.YH)(this,(function(e){return[2,Promise.all(this.queue.plugins.map((function(t){return t.ready?t.ready():Promise.resolve()}))).then((function(e){return t(e),e}))]}))}))},e.prototype.noConflict=function(){var t;return console.warn(Vo),t=null!=Jo?Jo:this,window[To]=t,this},e.prototype.normalize=function(t){return console.warn(Vo),this.eventFactory.normalize(t)},Object.defineProperty(e.prototype,"failedInitializations",{get:function(){return console.warn(Vo),this.queue.failedInitializations},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"VERSION",{get:function(){return On},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t,e){return(0,ln.sH)(this,void 0,void 0,(function(){return(0,ln.YH)(this,(function(t){return console.warn(Vo),[2,Promise.resolve(this)]}))}))},e.prototype.pageview=function(t){return(0,ln.sH)(this,void 0,void 0,(function(){return(0,ln.YH)(this,(function(e){switch(e.label){case 0:return console.warn(Vo),[4,this.page({path:t})];case 1:return e.sent(),[2,this]}}))}))},Object.defineProperty(e.prototype,"plugins",{get:function(){var t;return console.warn(Vo),null!==(t=this._plugins)&&void 0!==t?t:{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Integrations",{get:function(){return console.warn(Vo),this.queue.plugins.filter((function(t){return"destination"===t.type})).reduce((function(t,e){var r="".concat(e.name.toLowerCase().replace(".","").split(" ").join("-"),"Integration"),n=window[r];if(!n)return t;var o=n.Integration;return o?(t[e.name]=o,t):(t[e.name]=n,t)}),{})},enumerable:!1,configurable:!0}),e.prototype.push=function(t){var e=t.shift();e&&!this[e]||this[e].apply(this,t)},e}(Lt);!function(t){function e(){var e=t.call(this,{writeKey:""},{disableClientPersistence:!0})||this;return e.initialized=!0,e}(0,ln.C6)(e,t)}(ti);function ei(t){return ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ei(t)}var ri=function(t){var e=structuredClone(t);return"interaction"===e.type?"target"in e.data&&e.data.target&&"object"===ei(e.data.target)&&("value"in e.data.target&&void 0!==e.data.target.value&&(e.data.target.value=oi(e.data.target.value)),"checked"in e.data.target&&void 0!==e.data.target.checked&&(e.data.target.checked=oi(e.data.target.checked)),"formData"in e.data.target&&(e.data.target.formData=oi(e.data.target.formData)),"change"===e.data.eventType&&("change"in e.data&&(e.data.change=oi(e.data.change)),"mutation"===e.data.listener&&("innerText"in e.data.target&&(e.data.target.innerText=oi(e.data.target.innerText)),"textContent"in e.data.target&&(e.data.target.textContent=oi(e.data.target.textContent)),"attributes"in e.data.target&&(e.data.target.attributes=oi(e.data.target.attributes))),"contenteditable"===e.data.listener&&("textContent"in e.data.target&&(e.data.target.textContent=oi(e.data.target.textContent)),"innerText"in e.data.target&&(e.data.target.innerText=oi(e.data.target.innerText))))):"network"===e.type&&(e.data.data=oi(e.data.data)),e};function ni(t){var e=ei(t);return"boolean"===e||(["number","bigint"].includes(e)?999:null==t?t:"XXX")}function oi(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("object"===ei(t)&&t){if(Array.isArray(t))return t.map((function(t){return oi(t,e-1)}));var r={};for(var n in t)r[n]=oi(t[n],0===e?0:e-1);return r}if(e<=0){var o=ni(t);return o}return t}function ii(t){return ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ii(t)}function ai(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ui(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ai(Object(r),!0).forEach((function(e){yi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ai(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ci(){ci=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==ii(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ii(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function si(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function li(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){si(i,n,o,a,u,"next",t)}function u(t){si(i,n,o,a,u,"throw",t)}a(void 0)}))}}function fi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,di(n.key),n)}}function pi(t,e,r){return e&&fi(t.prototype,e),r&&fi(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function hi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yi(t,e,r){return(e=di(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function di(t){var e=function(t,e){if("object"!==ii(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ii(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ii(e)?e:String(e)}var vi=pi((function t(e){var r,n,o,i,a;hi(this,t),yi(this,"flushAt",void 0),yi(this,"flushInterval",void 0),yi(this,"apiHost",void 0),yi(this,"shouldDisableSignalsRedaction",void 0),yi(this,"shouldIngestSignals",void 0),yi(this,"writeKey",void 0),this.flushAt=null!==(r=e.flushAt)&&void 0!==r?r:5,this.apiHost=null!==(n=e.apiHost)&&void 0!==n?n:"signals.segment.io/v1",this.flushInterval=null!==(o=e.flushInterval)&&void 0!==o?o:2e3,this.shouldDisableSignalsRedaction=null!==(i=e.shouldDisableSignalsRedaction)&&void 0!==i?i:function(){return!1},this.shouldIngestSignals=null!==(a=e.shouldIngestSignals)&&void 0!==a?a:function(){return!1}})),gi=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};hi(this,t),yi(this,"settings",void 0),yi(this,"analytics",void 0),yi(this,"index",0),this.settings=new vi(r),this.analytics=this.createAnalyticsClient({writeKey:e})}var e,r;return pi(t,[{key:"createAnalyticsClient",value:(r=li(ci().mark((function t(e){var r;return ci().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ti({writeKey:e.writeKey}),this.settings.writeKey=r.settings.writeKey,t.next=4,r.register(qo(r,{apiHost:this.settings.apiHost,apiKey:this.settings.writeKey,deliveryStrategy:{config:{size:this.settings.flushAt,timeout:this.settings.flushInterval},strategy:"batching"}}));case 4:return r.emit("initialize",e),r.on("track",(function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];J.debug.apply(J,["Track event from analytics client"].concat(e))})),t.abrupt("return",r);case 7:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"sendTrackCall",value:(e=li(ci().mark((function t(e){var r,n,o;return ci().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.analytics;case 2:if(r=t.sent,this.settings.shouldIngestSignals()){t.next=5;break}return t.abrupt("return");case 5:return n=this.settings.shouldDisableSignalsRedaction(),o=n?e:ri(e),n&&J.debug("Sending unredacted data to segment",o),t.abrupt("return",r.track("Segment Signal Generated",ui({index:this.index++},o)));case 10:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"send",value:function(t){return this.sendTrackCall(t)}}]),t}();function mi(t){return mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mi(t)}function bi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Si(n.key),n)}}function wi(t,e,r){return(e=Si(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Si(t){var e=function(t,e){if("object"!==mi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==mi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===mi(e)?e:String(e)}var xi=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),wi(this,"client",void 0),wi(this,"ctx",void 0)}var e,r,n;return e=t,(r=[{key:"load",value:function(t){this.ctx=t,this.client=new gi(t.analyticsInstance.settings.writeKey,t.unstableGlobalSettings.ingestClient)}},{key:"process",value:function(t){this.client.send(t)}}])&&bi(e.prototype,r),n&&bi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Oi(t){return Oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oi(t)}function ji(){ji=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Oi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Oi(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function Ei(t){return function(t){if(Array.isArray(t))return ki(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return ki(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ki(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ki(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Li(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function _i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ii(n.key),n)}}function Pi(t,e,r){return(e=Ii(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ii(t){var e=function(t,e){if("object"!==Oi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Oi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Oi(e)?e:String(e)}var Ti=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Pi(this,"sandbox",void 0),Pi(this,"analytics",void 0),this.analytics=e,this.sandbox=r}var e,r,n,o,i;return e=t,r=[{key:"process",value:(o=ji().mark((function t(e,r){var n,o,i,a=this;return ji().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.sandbox.process(e,r);case 3:n=t.sent,t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),console.error("Error processing signal",{signal:e,signals:r},t.t0),t.abrupt("return");case 10:o=ji().mark((function t(){var e;return ji().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n[e=i].forEach((function(t){var r;J.info("New method call:","analytics.".concat(e,"()"),t),(r=a.analytics)[e].apply(r,Ei(t))}));case 3:case"end":return t.stop()}}),t)})),t.t1=ji().keys(n);case 12:if((t.t2=t.t1()).done){t.next=17;break}return i=t.t2.value,t.delegateYield(o(),"t3",15);case 15:t.next=12;break;case 17:case"end":return t.stop()}}),t,this,[[0,6]])})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){Li(i,r,n,a,u,"next",t)}function u(t){Li(i,r,n,a,u,"throw",t)}a(void 0)}))},function(t,e){return i.apply(this,arguments)})},{key:"cleanup",value:function(){return this.sandbox.jsSandbox.destroy()}}],r&&_i(e.prototype,r),n&&_i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Ci=atob("PHNjcmlwdD4KICBmdW5jdGlvbiB3b3JrZXJTY3JpcHQoKSB7CiAgICAidXNlIHN0cmljdCI7KCgpPT57ZnVuY3Rpb24gYihlLHIsdCl7cmV0dXJuIHAoSlNPTi5wYXJzZShlKSxyLHQpfXZhciBTPSgpPT4oZ2xvYmFsVGhpcy53b3JrZXJib3hJbmNyZW1lbnRvcj0oZ2xvYmFsVGhpcy53b3JrZXJib3hJbmNyZW1lbnRvcnx8MCkrMSxnbG9iYWxUaGlzLndvcmtlcmJveEluY3JlbWVudG9yKyJfIitBcnJheSgyMCkuZmlsbCgiIUAjJCVeJiooKV8rLT0wMTIzNDU2Nzg5QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiIpLm1hcChlPT5lW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSplLmxlbmd0aCldKS5qb2luKCIiKSk7ZnVuY3Rpb24geCgpe2xldCBlPXt9O3JldHVybntzdG9yZTplLGFkZDpuPT57bGV0IG89UygpO3JldHVybiBlW29dPW4sb30sZ2V0Om49PmVbbl19fWZ1bmN0aW9uIG0oZSxyLHQpe2lmKHR5cGVvZiBlPT0iZnVuY3Rpb24iKXJldHVyblsiY2FsbGJhY2siLHIoZSldO2lmKGUgaW5zdGFuY2VvZiBBcnJheSlyZXR1cm5bImFycmF5IixlLm1hcChuPT5tKG4scix0KSldO2lmKHR5cGVvZiBlPT0ib2JqZWN0IiYmZSE9PW51bGwpe2xldCBuPXt9O2ZvcihsZXQgbyBpbiBlKW5bb109bShlW29dLHIsdCk7cmV0dXJuWyJvYmplY3QiLG5dfWVsc2UgcmV0dXJuWyJsaXRlcmFsIixlXX1mdW5jdGlvbiBhKGUscix0KXtyZXR1cm4gSlNPTi5zdHJpbmdpZnkobShlLHIsdCkpfWZ1bmN0aW9uIHAoZSxyLHQpe2lmKGVbMF09PT0iY2FsbGJhY2siKXJldHVybiguLi5uKT0+dChlWzFdLGEobixyLHQpKTtpZihlWzBdPT09ImFycmF5IilyZXR1cm4gZVsxXS5tYXAobj0+cChuLHIsdCkpO2lmKGVbMF09PT0ib2JqZWN0Iil7bGV0IG49e307Zm9yKGxldCBvIGluIGVbMV0pbltvXT1wKGVbMV1bb10scix0KTtyZXR1cm4gbn1lbHNle2lmKGVbMF09PT0ibGl0ZXJhbCIpcmV0dXJuIGVbMV07dGhyb3cgRXJyb3IoYFVuZXhwZWN0ZWQgYXJnIHR5cGU6ICR7ZVswXX1gKX19ZnVuY3Rpb24gayhlLHIsdCl7cmV0dXJuIHAoSlNPTi5wYXJzZShlKSxyLHQpfWFzeW5jIGZ1bmN0aW9uIEUoZSxyKXtyZXR1cm4gYXdhaXQgRnVuY3Rpb24uYXBwbHkobnVsbCxbLi4uT2JqZWN0LmtleXMoZSksYHJldHVybiAoYXN5bmMgZnVuY3Rpb24gc2FuZGJveCAoKSB7JHtyfSB9KSgpYF0pLmFwcGx5KG51bGwsWy4uLk9iamVjdC52YWx1ZXMoZSldKX12YXIgdz0oZSxyKT0+e2lmKCFlLnN0YWNrKXJldHVybiBlLm1lc3NhZ2U7bGV0IHQ9ZS5zdGFjay5zcGxpdChgCmApLG49cz0+dHlwZW9mIHM9PSJzdHJpbmciP3BhcnNlSW50KHMsMTApOnM7cmV0dXJuW3RbMF0sLi4udC5maWx0ZXIocz0+cy5pbmNsdWRlcygiKGV2YWwgYXQgc2NvcGVkRXZhbCIpKS5tYXAocz0+e2xldCBkPXMuc3BsaXQoIihldmFsIGF0IHNjb3BlZEV2YWwgKCIpLFssbF09cy5zcGxpdCgiPGFub255bW91cz4iKSxbLGcsZl09bC5zbGljZSgwLC0xKS5zcGxpdCgiOiIpO3JldHVybmAke2RbMF19KDxzYW5kYm94Pjoke24oZyktM306JHtmfSlgfSldLnNsaWNlKDAscikuam9pbihgCmApfTtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLGU9PntsZXQgcj1lLnBvcnRzWzBdLHQ9eCgpLG49KG8scyk9Pm5ldyBQcm9taXNlKGQ9PntyLnBvc3RNZXNzYWdlKFsiY2FsbGJhY2siLHtpZDpvLGFyZ3M6cyxyZXNvbHZlOnQuYWRkKGQpfV0pfSk7ci5vbm1lc3NhZ2U9YXN5bmMgbz0+e2xldFtzLGRdPW8uZGF0YSx7aWQ6bCxlcnJvcklkOmcsY29kZTpmLHNjb3BlOmgsYXJnczp2LHJlc29sdmU6TSxyZWplY3Q6Rn09ZDtpZihzPT09ImV4ZWN1dGUiKXtsZXQgeT1iKGgsdC5hZGQsbik7dHJ5e2xldCBpPWF3YWl0IEUoeSxmKTtyLnBvc3RNZXNzYWdlKFsicmV0dXJuIix7aWQ6bCxhcmdzOmEoW2ldLHQuYWRkLG4pfV0pfWNhdGNoKGkpe2xldCBjPWk7dHJ5e2xldCB1PXcoYywtMSk7ci5wb3N0TWVzc2FnZShbImVycm9yIix7aWQ6ZyxhcmdzOmEoW3V8fGMubWVzc2FnZV0sdC5hZGQsbil9XSl9Y2F0Y2h7ci5wb3N0TWVzc2FnZShbImVycm9yIix7aWQ6ZyxhcmdzOmEoW2MubWVzc2FnZV0sdC5hZGQsbil9XSl9fX1pZihzPT09ImNhbGxiYWNrIil7bGV0IHk9ayh2LHQuYWRkLG4pLGk9dC5nZXQobCk7aWYoIWkpcmV0dXJuO3RyeXtsZXQgYz1hd2FpdCBpKC4uLnkpO3IucG9zdE1lc3NhZ2UoWyJyZXR1cm4iLHtpZDpNLGFyZ3M6YShbY10sdC5hZGQsbil9XSl9Y2F0Y2goYyl7bGV0IHU9YyxBPXcodSk7ci5wb3N0TWVzc2FnZShbImVycm9yIix7aWQ6RixhcmdzOmEoW0F8fHUubWVzc2FnZV0sdC5hZGQsbil9XSl9fX19KTt9KSgpOwoKICB9CgogIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGFzeW5jIChldmVudCkgPT4gewogICAgY29uc3QgY29kZSA9IHdvcmtlclNjcmlwdC50b1N0cmluZygpLnNwbGl0KCdcbicpLnNsaWNlKDEsIC0xKS5qb2luKCdcbicpOwogICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtjb2RlXSwgeyB0eXBlOiAnYXBwbGljYXRpb24vamF2YXNjcmlwdCcgfSkKICAgIGNvbnN0IHdvcmtlciA9IG5ldyBXb3JrZXIoVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSkKCiAgICB3b3JrZXIucG9zdE1lc3NhZ2UoJ09LJywgZXZlbnQucG9ydHMpOwogIH0pOwo8L3NjcmlwdD4=");function Ai(){Ai=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Ri(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ri(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function Ni(t){return function(t){if(Array.isArray(t))return Mi(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Gi(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fi(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(t,e)||Gi(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gi(t,e){if(t){if("string"==typeof t)return Mi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Mi(t,e):void 0}}function Mi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Di(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Hi(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Di(i,n,o,a,u,"next",t)}function u(t){Di(i,n,o,a,u,"throw",t)}a(void 0)}))}}function Ri(t){return Ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ri(t)}function Bi(){var t={};return{store:t,add:function(e){var r=(globalThis.workerboxIncrementor=(globalThis.workerboxIncrementor||0)+1,globalThis.workerboxIncrementor+"_"+Array(20).fill("!@#$%^&*()_+-=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz").map((function(t){return t[Math.floor(Math.random()*t.length)]})).join(""));return t[r]=e,r},get:function(e){return t[e]}}}function Yi(t,e,r){if("function"==typeof t)return["callback",e(t)];if(t instanceof Array)return["array",t.map((function(t){return Yi(t,e,r)}))];if("object"===Ri(t)&&null!==t){var n={};for(var o in t)n[o]=Yi(t[o],e,r);return["object",n]}return["literal",t]}function Ki(t,e,r){return JSON.stringify(Yi(t||{},e,r))}function zi(t,e,r){return JSON.stringify(Yi(t,e,r))}function Zi(t,e,r){if("callback"===t[0])return function(){for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return r(t[1],zi(o,e,r))};if("array"===t[0])return t[1].map((function(t){return Zi(t,e,r)}));if("object"===t[0]){var n={};for(var o in t[1])n[o]=Zi(t[1][o],e,r);return n}if("literal"===t[0])return t[1];throw Error("Unexpected arg type: ".concat(t[0]))}function Xi(t,e,r){return Zi(JSON.parse(t),e,r)}var Wi={count:0};function qi(t,e){Wi.count=Wi.count+1;var r=new MessageChannel,n=document.createElement("iframe");return n.setAttribute("sandbox","allow-scripts"),n.id="seg-workerbox-".concat(Wi.count),n.setAttribute("style","position: fixed; height: 0; width: 0; opacity: 0; top: -100px;"),t?n.src=t:n.srcdoc=Ci.toString(),document.body.appendChild(n),r.port1.onmessage=e,new Promise((function(t){n.addEventListener("load",(function(){if(!n.contentWindow)throw new Error("iframe.contentWindow is null");n.contentWindow.postMessage("OK","*",[r.port2]),t({postMessage:function(t){return r.port1.postMessage(t)},destroy:function(){return n.remove()}})}))}))}function Vi(){return Vi=Hi(Ai().mark((function t(){var e,r,n,o,i=arguments;return Ai().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(e=i.length>0&&void 0!==i[0]?i[0]:{}).url&&"/"===e.url.slice(-1)&&(e.url=e.url.slice(0,-1)),e.url=e.url&&new URL(e.url).href,r=Bi(),n=function(t,e){return new Promise((function(n,i){o.postMessage(["callback",{id:t,args:e,resolve:r.add(n),reject:r.add(i)}])}))},t.next=7,qi(e.url,function(){var t=Hi(Ai().mark((function t(e){var i,a,u,c,s,l,f,p,h,y,d,v,g;return Ai().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=Fi(e.data,2),a=i[0],u=i[1],c=u.id,s=u.args,l=u.resolve,f=u.reject,p=Xi(s,r.add,n),"error"!==a){t.next=5;break}return null===(h=r.get(c))||void 0===h||h(new Error(p[0])),t.abrupt("return");case 5:if("return"!==a){t.next=8;break}return null===(y=r.get(c))||void 0===y||y(p[0]),t.abrupt("return");case 8:if(d=r.get(c)){t.next=11;break}return t.abrupt("return");case 11:return t.prev=11,t.next=14,d.apply(void 0,Ni(p));case 14:v=t.sent,o.postMessage(["callback",{id:l,args:zi([v],r.add,n)}]),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(11),g=t.t0 instanceof Error?t.t0.message:t.t0,o.postMessage(["callback",{id:f,args:zi([g],r.add,n)}]);case 22:case"end":return t.stop()}}),t,null,[[11,18]])})));return function(e){return t.apply(this,arguments)}}());case 7:return o=t.sent,t.abrupt("return",{run:function(){var t=Hi(Ai().mark((function t(e,i){return Ai().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){var u=r.add(t),c=r.add(a),s=Ki(i,r.add,n);o.postMessage(["execute",{id:u,errorId:c,code:e,scope:s}])})));case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),destroy:function(){return o.destroy()},opts:e});case 9:case"end":return t.stop()}}),t)}))),Vi.apply(this,arguments)}var Ui={resolveAliasArguments:dn,resolveArguments:pn,resolvePageArguments:hn,resolveUserArguments:yn({id:function(){}})};Object.freeze({Track:"track",Page:"page",Screen:"screen",Identify:"identify",Group:"group",Alias:"alias"}),Object.freeze({URLChange:"urlChange",PageLoad:"pageLoad"}),Object.freeze({Interaction:"interaction",Navigation:"navigation",Network:"network",LocalData:"localData",Instrumentation:"instrumentation",UserDefined:"userDefined"}),Object.freeze({Interaction:"interaction",Navigation:"navigation",Network:"network",LocalData:"localData",Instrumentation:"instrumentation",UserDefined:"userDefined"}),Object.freeze({Track:"track",Page:"page",Screen:"screen",Identify:"identify",Group:"group",Alias:"alias"}),Object.freeze({Forward:"forward",Backward:"backward",Modal:"modal",Entering:"entering",Leaving:"leaving",Page:"page",Popup:"popup"}),Object.freeze({Request:"request",Response:"response"}),Object.freeze({Loaded:"loaded",Updated:"updated",Saved:"saved",Deleted:"deleted",Undefined:"undefined"});var Ji=["(function () {\n  // polyfill for globalThis\n  if (typeof globalThis === 'undefined') {\n    if (typeof self !== 'undefined') {\n      self.globalThis = self\n    } else if (typeof window !== 'undefined') {\n      window.globalThis = window\n    } else if (typeof global !== 'undefined') {\n      global.globalThis = global\n    } else {\n      throw new Error('Unable to locate global object')\n    }\n  }\n})()"].join("\n");function Qi(t){return Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qi(t)}function $i(){$i=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Qi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Qi(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function ta(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function ea(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ta(i,n,o,a,u,"next",t)}function u(t){ta(i,n,o,a,u,"throw",t)}a(void 0)}))}}function ra(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function na(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ra(Object(r),!0).forEach((function(e){sa(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ra(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function oa(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ia(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ia(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ia(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function aa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ua(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,la(n.key),n)}}function ca(t,e,r){return e&&ua(t.prototype,e),r&&ua(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function sa(t,e,r){return(e=la(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function la(t){var e=function(t,e){if("object"!==Qi(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Qi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Qi(e)?e:String(e)}var fa=function(){function t(){var e=this;aa(this,t),sa(this,"calls",{page:[],identify:[],track:[],alias:[],screen:[],group:[],reset:[]}),sa(this,"track",(function(){try{var t=Ui.resolveArguments.apply(Ui,arguments),r=oa(t,4),n=r[0],o=r[1],i=r[2],a=r[3];e.calls.track.push([n,o,e.stamp(i),a])}catch(t){console.error(t)}})),sa(this,"identify",(function(){try{var t=Ui.resolveUserArguments.apply(Ui,arguments),r=oa(t,4),n=r[0],o=r[1],i=r[2],a=r[3];e.calls.identify.push([n,o,e.stamp(i),a])}catch(t){console.error(t)}})),sa(this,"alias",(function(){try{var t=Ui.resolveAliasArguments.apply(Ui,arguments),r=oa(t,4),n=r[0],o=r[1],i=r[2],a=r[3];e.calls.alias.push([n,o,e.stamp(i),a])}catch(t){console.error(t)}})),sa(this,"group",(function(){try{var t=Ui.resolveUserArguments.apply(Ui,arguments),r=oa(t,4),n=r[0],o=r[1],i=r[2],a=r[3];e.calls.group.push([n,o,e.stamp(i),a])}catch(t){console.error(t)}})),sa(this,"page",(function(){try{var t=Ui.resolvePageArguments.apply(Ui,arguments),r=oa(t,5),n=r[0],o=r[1],i=r[2],a=r[3],u=r[4];e.stamp(a),e.calls.page.push([n,o,i,e.stamp(a),u])}catch(t){console.error(t)}})),sa(this,"screen",(function(){try{var t=Ui.resolvePageArguments.apply(Ui,arguments),r=oa(t,5),n=r[0],o=r[1],i=r[2],a=r[3],u=r[4];e.stamp(a),e.calls.screen.push([n,o,i,e.stamp(a),u])}catch(t){console.error(t)}})),sa(this,"reset",(function(){e.calls.reset.push([])}))}return ca(t,[{key:"getCalls",value:function(){return this.calls}},{key:"stamp",value:function(t){return t||(t={}),t.context=na(na({},t.context),{},{__eventOrigin:{type:"Signal"}}),t}}]),t}(),pa=function(){function t(){aa(this,t),sa(this,"workerbox",void 0),this.workerbox=function(){return Vi.apply(this,arguments)}()}var e,r;return ca(t,[{key:"run",value:(r=ea($i().mark((function t(e,r){var n;return $i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.workerbox;case 3:return n=t.sent,t.next=6,n.run(e,r);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("processSignal() error in sandbox",t.t0,{fn:e});case 11:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(t,e){return r.apply(this,arguments)})},{key:"destroy",value:(e=ea($i().mark((function t(){var e;return $i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.workerbox;case 2:return e=t.sent,t.next=5,e.destroy();case 5:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})}]),t}(),ha=ca((function t(e){var r;aa(this,t),sa(this,"processSignal",void 0);var n,o,i=e.functionHost&&e.edgeFnDownloadURL?(n=e.edgeFnDownloadURL,o="https://".concat(e.functionHost),/^https?:\/\//.test(o)||(o="https://"+o),n.replace(/^(https?:\/\/)?([^/]+)(\/.*)?$/,(function(t,e,r,n){return"".concat(o).concat(n||"")}))):e.edgeFnDownloadURL;if(!i&&!e.processSignal)return this.processSignal=Promise.resolve("globalThis.processSignal = function processSignal() {}"),void console.warn("No processSignal function found. Have you written a processSignal function on app.segment.com?");var a=null!==(r=e.edgeFnFetchClient)&&void 0!==r?r:globalThis.fetch,u=e.processSignal?Promise.resolve(e.processSignal).then((function(t){return"globalThis.processSignal = ".concat(t)})):a(i).then((function(t){return t.text()}));this.processSignal=u})),ya=function(){function t(e){aa(this,t),sa(this,"settings",void 0),sa(this,"jsSandbox",void 0),this.settings=e,this.jsSandbox=new pa}var e;return ca(t,[{key:"process",value:(e=ea($i().mark((function t(e,r){var n,o,i,a;return $i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new fa,o={analytics:n},J.debug("processing signal",{signal:e,scope:o,signals:r}),t.t0=Ji,t.next=6,this.settings.processSignal;case 6:return t.t1=t.sent,t.t2='\n"use strict";(()=>{var S=Object.defineProperty;var O=(t,e)=>{for(var r in e)S(t,r,{get:e[r],enumerable:!0})};function u(t){"@babel/helpers - typeof";return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(t)}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,p(n.key),n)}}function P(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e,r){return e=p(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function p(t){var e=w(t,"string");return u(e)==="symbol"?e:String(e)}function w(t,e){if(u(t)!=="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(u(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var m=P(function t(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];d(this,t),b(this,"find",function(n,i,o){return e.filter(n,i,o)[0]}),b(this,"filter",function(n,i,o){var h=function(_){return _.type===i};return e.signalBuffer.slice(e.signalBuffer.indexOf(n)+1).filter(h).filter(function(y){return o?o(y):function(){return!0}})}),this.signalBuffer=r});function f(t){"@babel/helpers - typeof";return f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(t)}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,R(n.key),n)}}function j(t,e,r){return e&&g(t.prototype,e),r&&g(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function R(t){var e=T(t,"string");return f(e)==="symbol"?e:String(e)}function T(t,e){if(f(t)!=="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(f(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},l(t,e)}function N(t){var e=D();return function(){var n=a(t),i;if(e){var o=a(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return k(this,i)}}function k(t,e){if(e&&(f(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return B(t)}function B(t){if(t===void 0)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return t}function D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},a(t)}var v=function(t){E(r,t);var e=N(r);function r(){return x(this,r),e.apply(this,arguments)}return j(r)}(m);var c={};O(c,{EventType:()=>I,NavigationAction:()=>z,SignalType:()=>L});var I=Object.freeze({Track:"track",Page:"page",Screen:"screen",Identify:"identify",Group:"group",Alias:"alias"}),z=Object.freeze({URLChange:"urlChange",PageLoad:"pageLoad"}),L=Object.freeze({Interaction:"interaction",Navigation:"navigation",Network:"network",LocalData:"localData",Instrumentation:"instrumentation",UserDefined:"userDefined"});Object.assign(globalThis,{signals:new v},c);})();\n',t.t3="signals.signalBuffer = ".concat(JSON.stringify(r),";"),t.t4="try { processSignal("+JSON.stringify(e)+', { analytics, signals, SignalType, EventType, NavigationAction }); } catch(err) { console.error("Process signal failed.", err); }',i=[t.t0,t.t1,t.t2,t.t3,t.t4].join("\n"),t.next=13,this.jsSandbox.run(i,o);case 13:return a=n.getCalls(),t.abrupt("return",a);case 15:case"end":return t.stop()}}),t,this)}))),function(t,r){return e.apply(this,arguments)})}]),t}();function da(t){return da="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},da(t)}function va(){va=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==da(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(da(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function ga(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function ma(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,wa(n.key),n)}}function ba(t,e,r){return(e=wa(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function wa(t){var e=function(t,e){if("object"!==da(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==da(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===da(e)?e:String(e)}var Sa=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ba(this,"processor",void 0),ba(this,"buffer",void 0)}var e,r,n,o,i;return e=t,r=[{key:"load",value:function(t){this.buffer=t.buffer,this.processor=new Ti(t.analyticsInstance,new ya(new ha(t.unstableGlobalSettings.sandbox)))}},{key:"process",value:(o=va().mark((function t(e){return va().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=this.processor,t.t1=e,t.next=4,this.buffer.getAll();case 4:return t.t2=t.sent,t.abrupt("return",t.t0.process.call(t.t0,t.t1,t.t2));case 6:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){ga(i,r,n,a,u,"next",t)}function u(t){ga(i,r,n,a,u,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})}],r&&ma(e.prototype,r),n&&ma(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function xa(t){return xa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xa(t)}function Oa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ja(n.key),n)}}function ja(t){var e=function(t,e){if("object"!==xa(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==xa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===xa(e)?e:String(e)}var Ea=function(){function t(){var e,r,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=this,n=void 0,(r=ja(r="user"))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n}var e,r,n;return e=t,(r=[{key:"load",value:function(t){this.user=t.analyticsInstance.user()}},{key:"process",value:function(t){return t.anonymousId=this.user.anonymousId(),t}}])&&Oa(e.prototype,r),n&&Oa(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ka(t){return ka="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ka(t)}function La(){La=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==ka(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ka(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function _a(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Pa(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){_a(i,n,o,a,u,"next",t)}function u(t){_a(i,n,o,a,u,"throw",t)}a(void 0)}))}}function Ia(t){return function(t){if(Array.isArray(t))return Ta(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Ta(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ta(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ta(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ca(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Aa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Fa(n.key),n)}}function Na(t,e,r){return(e=Fa(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Fa(t){var e=function(t,e){if("object"!==ka(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ka(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ka(e)?e:String(e)}var Ga=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ca(this,t),Na(this,"buffer",void 0),Na(this,"signalEmitter",void 0),Na(this,"cleanup",[]),Na(this,"globalSettings",void 0),this.globalSettings=new cn(e),e.debug&&this.debug(),this.buffer=lt(this.globalSettings.signalBuffer),this.signalEmitter=this.getSignalEmitter(e.middleware),this.registerGenerator([].concat(Ia(We),[new _r]))}var e,r,n,o,i;return e=t,r=[{key:"start",value:(i=Pa(La().mark((function t(e){var r,n,o,i,a=this;return La().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=new Hr(e)).instance.on("reset",(function(){a.clearStorage()})),this.globalSettings.update({edgeFnDownloadURL:null===(r=i.edgeFnSettings)||void 0===r?void 0:r.downloadURL,disallowListURLs:[i.instance.settings.apiHost,i.instance.settings.cdnURL],sampleRate:null!==(n=null===(o=i.instance.settings.cdnSettings.autoInstrumentationSettings)||void 0===o?void 0:o.sampleRate)&&void 0!==n?n:0}),t.next=5,this.registerGenerator([i.createSegmentInstrumentationEventGenerator()]);case 5:this.signalEmitter.start({unstableGlobalSettings:this.globalSettings,analyticsInstance:i.instance,buffer:this.buffer});case 6:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"stop",value:function(){this.cleanup.forEach((function(t){return t()}))}},{key:"clearStorage",value:function(){this.buffer.clear()}},{key:"debug",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;this.globalSettings.signalsDebug.setAllDebugging(t),J.enableLogging(null!=e?e:"info")}},{key:"registerGenerator",value:(o=Pa(La().mark((function t(e){return La().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.signalEmitter){t.next=2;break}throw new Error("SignalEmitter not initialized");case 2:if(this.globalSettings){t.next=4;break}throw new Error("GlobalSettings not initialized");case 4:return t.t0=this.cleanup,t.next=7,Cr(this.signalEmitter,e,this.globalSettings);case 7:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 9:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"getSignalEmitter",value:function(t){var e,r=this;return(e=new kt).addMiddleware.apply(e,[new Ea,new Qr].concat(Ia(t||[]))).subscribe((function(t){return J.logSignal(t)}),(function(t){return r.buffer.add(t)}),new xi,new Sa)}}],r&&Aa(e.prototype,r),n&&Aa(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Ma=function(){if("undefined"==typeof window)throw new Error("This can only be run in a browser environment.")},Da="1.12.0";function Ha(t){return Ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ha(t)}function Ra(){Ra=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),u=new P(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="executing",y="completed",d={};function v(){}function g(){}function m(){}var b={};s(b,a,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(I([])));S&&S!==r&&n.call(S,a)&&(b=S);var x=m.prototype=v.prototype=Object.create(b);function O(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function j(t,e){function r(o,i,a,u){var c=f(t[o],t,i);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==Ha(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function E(e,r,n){var o=p;return function(i,a){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=k(u,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:"suspendedYield",s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function k(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,d;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ha(e)+" is not iterable")}return g.prototype=m,o(x,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:g,configurable:!0}),g.displayName=s(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},O(j.prototype),s(j.prototype,u,(function(){return this})),e.AsyncIterator=j,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new j(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(x),s(x,c,"Generator"),s(x,a,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}function Ba(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function Ya(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ka(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Za(n.key),n)}}function za(t,e,r){return(e=Za(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Za(t){var e=function(t,e){if("object"!==Ha(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Ha(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Ha(e)?e:String(e)}var Xa=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ya(this,t),za(this,"type","utility"),za(this,"name","SignalsPlugin"),za(this,"version",Da),za(this,"signals",void 0),Ma(),Object.assign(window,{SegmentSignalsPlugin:this}),this.signals=new Ga({debug:e.debug,disableSignalsRedaction:e.disableSignalsRedaction,enableSignalsIngestion:e.enableSignalsIngestion,flushAt:e.flushAt,flushInterval:e.flushInterval,functionHost:e.functionHost,apiHost:e.apiHost,maxBufferSize:e.maxBufferSize,processSignal:"function"==typeof e.processSignal?e.processSignal.toString():e.processSignal,networkSignalsAllowSameDomain:e.networkSignalsAllowSameDomain,networkSignalsAllowList:e.networkSignalsAllowList,networkSignalsDisallowList:e.networkSignalsDisallowList,signalStorage:e.signalStorage,signalStorageType:e.signalStorageType,middleware:e.middleware}),J.debug("SignalsPlugin v".concat(Da," initializing"),{settings:e})}var e,r,n,o,i;return e=t,r=[{key:"isLoaded",value:function(){return!0}},{key:"load",value:(o=Ra().mark((function t(e,r){return Ra().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.signals.start(r);case 3:J.debug("SignalsPlugin loaded"),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.error(t.t0);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){Ba(i,r,n,a,u,"next",t)}function u(t){Ba(i,r,n,a,u,"throw",t)}a(void 0)}))},function(t,e){return i.apply(this,arguments)})},{key:"stop",value:function(){return this.signals.stop()}},{key:"onSignal",value:function(t){return this.signals.signalEmitter.subscribe(t),this}},{key:"addSignal",value:function(t){return this.signals.signalEmitter.emit(function(t){return Mt("userDefined",t)}(t)),this}},{key:"debug",value:function(){var t;return(t=this.signals).debug.apply(t,arguments),this}}],r&&Ka(e.prototype,r),n&&Ka(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();"undefined"!=typeof window&&(window.SignalsPlugin=Xa)}(),i}()}));
//# sourceMappingURL=analytics-signals.umd.js.map