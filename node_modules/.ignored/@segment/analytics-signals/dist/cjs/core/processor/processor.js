"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SignalEventProcessor = void 0;
const logger_1 = require("../../lib/logger");
class SignalEventProcessor {
    constructor(analytics, sandbox) {
        this.analytics = analytics;
        this.sandbox = sandbox;
    }
    async process(signal, signals) {
        let analyticsMethodCalls;
        try {
            analyticsMethodCalls = await this.sandbox.process(signal, signals);
        }
        catch (err) {
            // in practice, we should never hit this error, but if we do, we should log it.
            console.error('Error processing signal', { signal, signals }, err);
            return;
        }
        for (const methodName in analyticsMethodCalls) {
            const name = methodName;
            const eventsCollection = analyticsMethodCalls[name];
            eventsCollection.forEach((args) => {
                logger_1.logger.info('New method call:', `analytics.${name}()`, args);
                // @ts-ignore
                this.analytics[name](...args);
            });
        }
    }
    cleanup() {
        return this.sandbox.jsSandbox.destroy();
    }
}
exports.SignalEventProcessor = SignalEventProcessor;
//# sourceMappingURL=processor.js.map